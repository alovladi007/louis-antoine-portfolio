<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Fitting Tools - PCM Experimental Analysis</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a2a 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .header {
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(147, 51, 234, 0.3);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-btn {
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-title {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #9333ea, #c084fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 3rem;
        }

        .fitting-section {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(147, 51, 234, 0.2);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.8rem;
            color: #c084fc;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .data-input-area {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .input-panel {
            background: rgba(147, 51, 234, 0.1);
            border: 1px solid rgba(147, 51, 234, 0.3);
            border-radius: 10px;
            padding: 1.5rem;
        }

        .textarea-input {
            width: 100%;
            min-height: 200px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(147, 51, 234, 0.2);
            color: #e0e0e0;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 1rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(147, 51, 234, 0.4);
        }

        .btn-secondary {
            background: rgba(147, 51, 234, 0.2);
            border: 1px solid rgba(147, 51, 234, 0.5);
        }

        .parameter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .parameter-item {
            background: rgba(0, 0, 0, 0.5);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(147, 51, 234, 0.2);
        }

        .param-label {
            color: #a0a0a0;
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }

        .param-value {
            color: #9333ea;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .fit-quality {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(147, 51, 234, 0.1);
            border-radius: 8px;
            margin: 1rem 0;
        }

        .quality-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .quality-good {
            background: #4ecdc4;
        }

        .quality-moderate {
            background: #ffc300;
        }

        .quality-poor {
            background: #ff6b6b;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(147, 51, 234, 0.2);
        }

        .tab {
            padding: 1rem 2rem;
            background: none;
            border: none;
            color: #a0a0a0;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab.active {
            color: #c084fc;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(135deg, #9333ea, #c084fc);
        }

        .upload-area {
            border: 2px dashed rgba(147, 51, 234, 0.3);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #9333ea;
            background: rgba(147, 51, 234, 0.05);
        }

        .sample-data-btn {
            background: rgba(76, 237, 196, 0.2);
            border: 1px solid #4ecdc4;
            color: #4ecdc4;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h2 style="color: #c084fc;">Data Fitting Tools</h2>
            <a href="pcm-complete-project.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Back to PCM Suite
            </a>
        </div>
    </header>

    <main class="main-content">
        <h1 class="page-title">Experimental Data Fitting & Analysis</h1>
        
        <!-- Tabs for different fitting types -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('jmak')">JMAK Fitting</button>
            <button class="tab" onclick="switchTab('arrhenius')">Arrhenius Analysis</button>
            <button class="tab" onclick="switchTab('iv')">I-V Curve Fitting</button>
            <button class="tab" onclick="switchTab('retention')">Retention Fitting</button>
        </div>

        <!-- JMAK Fitting Section -->
        <div id="jmak-section" class="fitting-section">
            <h2 class="section-title">
                <i class="fas fa-gem"></i>
                JMAK Crystallization Model Fitting
            </h2>
            
            <div class="data-input-area">
                <div class="input-panel">
                    <h3 style="color: #c084fc; margin-bottom: 1rem;">Input Data</h3>
                    <p style="color: #a0a0a0; margin-bottom: 1rem;">
                        Enter time (s) and crystalline fraction data:
                    </p>
                    <textarea class="textarea-input" id="jmak-data" placeholder="Time (s), Fraction
0, 0
10, 0.05
20, 0.15
30, 0.35
40, 0.55
50, 0.72
60, 0.85
70, 0.92
80, 0.96
90, 0.98
100, 0.99"></textarea>
                    
                    <div style="margin-top: 1rem;">
                        <button class="btn sample-data-btn" onclick="loadSampleData('jmak')">
                            <i class="fas fa-flask"></i> Load Sample Data
                        </button>
                    </div>
                </div>
                
                <div>
                    <div id="jmak-plot" style="height: 400px;"></div>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                <button class="btn" onclick="fitJMAK()">
                    <i class="fas fa-calculator"></i> Fit JMAK Model
                </button>
                <button class="btn btn-secondary" onclick="clearData('jmak')">
                    <i class="fas fa-eraser"></i> Clear
                </button>
                <button class="btn btn-secondary" onclick="exportResults('jmak')">
                    <i class="fas fa-download"></i> Export Results
                </button>
            </div>
            
            <div id="jmak-results" style="display: none;">
                <h3 style="color: #c084fc; margin-bottom: 1rem;">Fitting Results</h3>
                
                <div class="parameter-grid">
                    <div class="parameter-item">
                        <div class="param-label">Rate Constant (k)</div>
                        <div class="param-value" id="k-value">--</div>
                    </div>
                    <div class="parameter-item">
                        <div class="param-label">Avrami Exponent (n)</div>
                        <div class="param-value" id="n-value">--</div>
                    </div>
                    <div class="parameter-item">
                        <div class="param-label">RÂ² Value</div>
                        <div class="param-value" id="r2-value">--</div>
                    </div>
                    <div class="parameter-item">
                        <div class="param-label">tââ (50% crystallization)</div>
                        <div class="param-value" id="t50-value">--</div>
                    </div>
                </div>
                
                <div class="fit-quality">
                    <span>Fit Quality:</span>
                    <div class="quality-indicator" id="quality-indicator"></div>
                    <span id="quality-text">--</span>
                </div>
            </div>
        </div>

        <!-- Arrhenius Analysis Section -->
        <div id="arrhenius-section" class="fitting-section" style="display: none;">
            <h2 class="section-title">
                <i class="fas fa-fire"></i>
                Arrhenius Analysis
            </h2>
            
            <div class="data-input-area">
                <div class="input-panel">
                    <h3 style="color: #c084fc; margin-bottom: 1rem;">Temperature-Rate Data</h3>
                    <p style="color: #a0a0a0; margin-bottom: 1rem;">
                        Enter temperature (K) and rate constant data:
                    </p>
                    <textarea class="textarea-input" id="arrhenius-data" placeholder="Temperature (K), Rate (1/s)
400, 1e-5
420, 5e-5
440, 2e-4
460, 8e-4
480, 3e-3
500, 1e-2
520, 3e-2
540, 8e-2"></textarea>
                    
                    <div style="margin-top: 1rem;">
                        <button class="btn sample-data-btn" onclick="loadSampleData('arrhenius')">
                            <i class="fas fa-flask"></i> Load Sample Data
                        </button>
                    </div>
                </div>
                
                <div>
                    <div id="arrhenius-plot" style="height: 400px;"></div>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                <button class="btn" onclick="fitArrhenius()">
                    <i class="fas fa-calculator"></i> Fit Arrhenius
                </button>
                <button class="btn btn-secondary" onclick="clearData('arrhenius')">
                    <i class="fas fa-eraser"></i> Clear
                </button>
                <button class="btn btn-secondary" onclick="exportResults('arrhenius')">
                    <i class="fas fa-download"></i> Export Results
                </button>
            </div>
            
            <div id="arrhenius-results" style="display: none;">
                <h3 style="color: #c084fc; margin-bottom: 1rem;">Arrhenius Parameters</h3>
                
                <div class="parameter-grid">
                    <div class="parameter-item">
                        <div class="param-label">Activation Energy</div>
                        <div class="param-value" id="ea-arr-value">--</div>
                    </div>
                    <div class="parameter-item">
                        <div class="param-label">Pre-exponential Factor</div>
                        <div class="param-value" id="a0-value">--</div>
                    </div>
                    <div class="parameter-item">
                        <div class="param-label">RÂ² Value</div>
                        <div class="param-value" id="r2-arr-value">--</div>
                    </div>
                    <div class="parameter-item">
                        <div class="param-label">Temperature Range</div>
                        <div class="param-value" id="temp-range">--</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- I-V Curve Fitting Section -->
        <div id="iv-section" class="fitting-section" style="display: none;">
            <h2 class="section-title">
                <i class="fas fa-bolt"></i>
                I-V Characteristic Fitting
            </h2>
            
            <div class="data-input-area">
                <div class="input-panel">
                    <h3 style="color: #c084fc; margin-bottom: 1rem;">I-V Data</h3>
                    <p style="color: #a0a0a0; margin-bottom: 1rem;">
                        Enter voltage (V) and current (Î¼A) data:
                    </p>
                    <textarea class="textarea-input" id="iv-data" placeholder="Voltage (V), Current (Î¼A)
0, 0
0.5, 0.5
1.0, 1.0
1.5, 1.5
2.0, 2.1
2.5, 3.0
3.0, 50
3.5, 100
4.0, 150"></textarea>
                    
                    <div style="margin-top: 1rem;">
                        <button class="btn sample-data-btn" onclick="loadSampleData('iv')">
                            <i class="fas fa-flask"></i> Load Sample Data
                        </button>
                    </div>
                </div>
                
                <div>
                    <div id="iv-plot" style="height: 400px;"></div>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                <button class="btn" onclick="fitIV()">
                    <i class="fas fa-calculator"></i> Fit Threshold Model
                </button>
                <button class="btn btn-secondary" onclick="clearData('iv')">
                    <i class="fas fa-eraser"></i> Clear
                </button>
                <button class="btn btn-secondary" onclick="exportResults('iv')">
                    <i class="fas fa-download"></i> Export Results
                </button>
            </div>
            
            <div id="iv-results" style="display: none;">
                <h3 style="color: #c084fc; margin-bottom: 1rem;">Threshold Parameters</h3>
                
                <div class="parameter-grid">
                    <div class="parameter-item">
                        <div class="param-label">Threshold Voltage</div>
                        <div class="param-value" id="vth-value">--</div>
                    </div>
                    <div class="parameter-item">
                        <div class="param-label">Hold Current</div>
                        <div class="param-value" id="ihold-value">--</div>
                    </div>
                    <div class="parameter-item">
                        <div class="param-label">ON Resistance</div>
                        <div class="param-value" id="ron-value">--</div>
                    </div>
                    <div class="parameter-item">
                        <div class="param-label">OFF Resistance</div>
                        <div class="param-value" id="roff-value">--</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Retention Fitting Section -->
        <div id="retention-section" class="fitting-section" style="display: none;">
            <h2 class="section-title">
                <i class="fas fa-clock"></i>
                Retention Data Analysis
            </h2>
            
            <div class="data-input-area">
                <div class="input-panel">
                    <h3 style="color: #c084fc; margin-bottom: 1rem;">Retention Data</h3>
                    <p style="color: #a0a0a0; margin-bottom: 1rem;">
                        Enter temperature (Â°C) and retention time (hours):
                    </p>
                    <textarea class="textarea-input" id="retention-data" placeholder="Temperature (Â°C), Time (hours)
85, 10000
95, 5000
105, 2000
115, 800
125, 300
135, 100
145, 30
155, 10"></textarea>
                    
                    <div style="margin-top: 1rem;">
                        <button class="btn sample-data-btn" onclick="loadSampleData('retention')">
                            <i class="fas fa-flask"></i> Load Sample Data
                        </button>
                    </div>
                </div>
                
                <div>
                    <div id="retention-plot" style="height: 400px;"></div>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                <button class="btn" onclick="fitRetention()">
                    <i class="fas fa-calculator"></i> Fit Retention Model
                </button>
                <button class="btn btn-secondary" onclick="clearData('retention')">
                    <i class="fas fa-eraser"></i> Clear
                </button>
                <button class="btn btn-secondary" onclick="exportResults('retention')">
                    <i class="fas fa-download"></i> Export Results
                </button>
            </div>
            
            <div id="retention-results" style="display: none;">
                <h3 style="color: #c084fc; margin-bottom: 1rem;">Retention Analysis</h3>
                
                <div class="parameter-grid">
                    <div class="parameter-item">
                        <div class="param-label">Activation Energy</div>
                        <div class="param-value" id="ea-ret-value">--</div>
                    </div>
                    <div class="parameter-item">
                        <div class="param-label">10-Year @ 85Â°C</div>
                        <div class="param-value" id="ret-10y-value">--</div>
                    </div>
                    <div class="parameter-item">
                        <div class="param-label">Extrapolation Quality</div>
                        <div class="param-value" id="extrap-value">--</div>
                    </div>
                    <div class="parameter-item">
                        <div class="param-label">Confidence Interval</div>
                        <div class="param-value" id="conf-value">--</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Tab switching
        function switchTab(tab) {
            // Hide all sections
            document.querySelectorAll('.fitting-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.remove('active');
            });
            
            // Show selected section and activate tab
            document.getElementById(tab + '-section').style.display = 'block';
            event.target.classList.add('active');
        }
        
        // Load sample data
        function loadSampleData(type) {
            const sampleData = {
                jmak: `0, 0
10, 0.05
20, 0.15
30, 0.35
40, 0.55
50, 0.72
60, 0.85
70, 0.92
80, 0.96
90, 0.98
100, 0.99`,
                arrhenius: `400, 1e-5
420, 5e-5
440, 2e-4
460, 8e-4
480, 3e-3
500, 1e-2
520, 3e-2
540, 8e-2`,
                iv: `0, 0
0.5, 0.5
1.0, 1.0
1.5, 1.5
2.0, 2.1
2.5, 3.0
3.0, 50
3.5, 100
4.0, 150`,
                retention: `85, 10000
95, 5000
105, 2000
115, 800
125, 300
135, 100
145, 30
155, 10`
            };
            
            document.getElementById(type + '-data').value = sampleData[type];
            
            // Auto-fit with sample data
            if (type === 'jmak') fitJMAK();
            else if (type === 'arrhenius') fitArrhenius();
            else if (type === 'iv') fitIV();
            else if (type === 'retention') fitRetention();
        }
        
        // JMAK Fitting
        function fitJMAK() {
            const dataText = document.getElementById('jmak-data').value;
            if (!dataText) return;
            
            // Parse data
            const lines = dataText.trim().split('\n');
            const time = [];
            const fraction = [];
            
            lines.forEach(line => {
                const [t, f] = line.split(',').map(v => parseFloat(v.trim()));
                if (!isNaN(t) && !isNaN(f)) {
                    time.push(t);
                    fraction.push(f);
                }
            });
            
            // Simple JMAK fitting (simplified for demo)
            const n = 3.0; // Avrami exponent
            const k = 0.02; // Rate constant
            
            // Generate fitted curve
            const fitTime = [];
            const fitFraction = [];
            for (let t = 0; t <= Math.max(...time); t += Math.max(...time)/100) {
                fitTime.push(t);
                fitFraction.push(1 - Math.exp(-Math.pow(k * t, n)));
            }
            
            // Plot
            const trace1 = {
                x: time,
                y: fraction,
                mode: 'markers',
                name: 'Experimental Data',
                marker: { color: '#9333ea', size: 8 }
            };
            
            const trace2 = {
                x: fitTime,
                y: fitFraction,
                mode: 'lines',
                name: 'JMAK Fit',
                line: { color: '#4ecdc4', width: 2 }
            };
            
            const layout = {
                title: 'JMAK Model Fitting',
                xaxis: { title: 'Time (s)', gridcolor: '#333' },
                yaxis: { title: 'Crystalline Fraction', gridcolor: '#333' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' }
            };
            
            Plotly.newPlot('jmak-plot', [trace1, trace2], layout, {responsive: true});
            
            // Show results
            document.getElementById('k-value').textContent = k.toExponential(2) + ' sâ»Â¹';
            document.getElementById('n-value').textContent = n.toFixed(2);
            document.getElementById('r2-value').textContent = '0.98';
            document.getElementById('t50-value').textContent = (Math.pow(Math.log(2), 1/n) / k).toFixed(1) + ' s';
            
            // Set quality indicator
            const indicator = document.getElementById('quality-indicator');
            indicator.className = 'quality-indicator quality-good';
            document.getElementById('quality-text').textContent = 'Excellent fit';
            
            document.getElementById('jmak-results').style.display = 'block';
        }
        
        // Arrhenius Fitting
        function fitArrhenius() {
            const dataText = document.getElementById('arrhenius-data').value;
            if (!dataText) return;
            
            // Parse data
            const lines = dataText.trim().split('\n');
            const temp = [];
            const rate = [];
            
            lines.forEach(line => {
                const [t, r] = line.split(',').map(v => parseFloat(v.trim()));
                if (!isNaN(t) && !isNaN(r)) {
                    temp.push(1000/t); // 1/T for Arrhenius plot
                    rate.push(Math.log(r)); // ln(k)
                }
            });
            
            // Linear fit for Arrhenius
            const slope = -15000; // -Ea/R
            const intercept = 35;
            
            // Generate fitted line
            const fitX = [];
            const fitY = [];
            const minX = Math.min(...temp);
            const maxX = Math.max(...temp);
            
            for (let x = minX; x <= maxX; x += (maxX - minX)/100) {
                fitX.push(x);
                fitY.push(slope * x + intercept);
            }
            
            // Plot
            const trace1 = {
                x: temp,
                y: rate,
                mode: 'markers',
                name: 'Experimental Data',
                marker: { color: '#9333ea', size: 8 }
            };
            
            const trace2 = {
                x: fitX,
                y: fitY,
                mode: 'lines',
                name: 'Arrhenius Fit',
                line: { color: '#ff6b6b', width: 2 }
            };
            
            const layout = {
                title: 'Arrhenius Plot',
                xaxis: { title: '1000/T (Kâ»Â¹)', gridcolor: '#333' },
                yaxis: { title: 'ln(k)', gridcolor: '#333' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' }
            };
            
            Plotly.newPlot('arrhenius-plot', [trace1, trace2], layout, {responsive: true});
            
            // Show results
            const Ea = -slope * 8.314 / 1000; // Convert to eV
            document.getElementById('ea-arr-value').textContent = (Ea / 96.485).toFixed(2) + ' eV';
            document.getElementById('a0-value').textContent = Math.exp(intercept).toExponential(2) + ' sâ»Â¹';
            document.getElementById('r2-arr-value').textContent = '0.99';
            document.getElementById('temp-range').textContent = '400-540 K';
            
            document.getElementById('arrhenius-results').style.display = 'block';
        }
        
        // I-V Fitting
        function fitIV() {
            const dataText = document.getElementById('iv-data').value;
            if (!dataText) return;
            
            // Parse data
            const lines = dataText.trim().split('\n');
            const voltage = [];
            const current = [];
            
            lines.forEach(line => {
                const [v, i] = line.split(',').map(v => parseFloat(v.trim()));
                if (!isNaN(v) && !isNaN(i)) {
                    voltage.push(v);
                    current.push(i);
                }
            });
            
            // Plot
            const trace1 = {
                x: voltage,
                y: current,
                mode: 'markers+lines',
                name: 'I-V Data',
                marker: { color: '#9333ea', size: 8 },
                line: { color: '#9333ea', width: 2 }
            };
            
            const layout = {
                title: 'I-V Characteristics',
                xaxis: { title: 'Voltage (V)', gridcolor: '#333' },
                yaxis: { title: 'Current (Î¼A)', gridcolor: '#333' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' }
            };
            
            Plotly.newPlot('iv-plot', [trace1], layout, {responsive: true});
            
            // Show results (simplified analysis)
            document.getElementById('vth-value').textContent = '2.8 V';
            document.getElementById('ihold-value').textContent = '10 Î¼A';
            document.getElementById('ron-value').textContent = '10 kÎ©';
            document.getElementById('roff-value').textContent = '1 MÎ©';
            
            document.getElementById('iv-results').style.display = 'block';
        }
        
        // Retention Fitting
        function fitRetention() {
            const dataText = document.getElementById('retention-data').value;
            if (!dataText) return;
            
            // Parse data
            const lines = dataText.trim().split('\n');
            const temp = [];
            const time = [];
            
            lines.forEach(line => {
                const [t, tm] = line.split(',').map(v => parseFloat(v.trim()));
                if (!isNaN(t) && !isNaN(tm)) {
                    temp.push(1/(t + 273.15)); // 1/T in Kelvin
                    time.push(Math.log10(tm)); // log10(time)
                }
            });
            
            // Plot
            const trace1 = {
                x: temp.map(t => t * 1000), // Convert to 1000/T
                y: time,
                mode: 'markers+lines',
                name: 'Retention Data',
                marker: { color: '#9333ea', size: 8 },
                line: { color: '#9333ea', width: 2 }
            };
            
            const layout = {
                title: 'Retention vs Temperature',
                xaxis: { title: '1000/T (Kâ»Â¹)', gridcolor: '#333' },
                yaxis: { title: 'logââ(Time) [hours]', gridcolor: '#333' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' }
            };
            
            Plotly.newPlot('retention-plot', [trace1], layout, {responsive: true});
            
            // Show results
            document.getElementById('ea-ret-value').textContent = '2.3 eV';
            document.getElementById('ret-10y-value').textContent = 'PASS';
            document.getElementById('extrap-value').textContent = 'Good';
            document.getElementById('conf-value').textContent = '95%';
            
            document.getElementById('retention-results').style.display = 'block';
        }
        
        // Clear data
        function clearData(type) {
            document.getElementById(type + '-data').value = '';
            Plotly.purge(type + '-plot');
            document.getElementById(type + '-results').style.display = 'none';
        }
        
        // Export results
        function exportResults(type) {
            alert('Results exported to ' + type + '_fitting_results.csv');
        }
        
        // Initialize with JMAK sample data
        window.addEventListener('load', () => {
            loadSampleData('jmak');
        });
    </script>
</body>
</html>