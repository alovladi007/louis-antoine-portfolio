<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EUV Lithography Lab - 13.5nm Extreme Ultraviolet Simulation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.1), rgba(147, 51, 234, 0.05));
            border-radius: 20px;
        }
        
        h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }
        
        .euv-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
        }
        
        .control-panel {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(147, 51, 234, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            height: fit-content;
        }
        
        .viz-area {
            display: grid;
            gap: 2rem;
        }
        
        .viz-panel {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(147, 51, 234, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
        }
        
        .panel-title {
            color: #9333ea;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .control-group {
            margin-bottom: 1.5rem;
        }
        
        .control-group label {
            display: block;
            color: #9333ea;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .control-group input[type="range"],
        .control-group select,
        .control-group input[type="number"] {
            width: 100%;
            padding: 0.5rem;
            background: #222;
            border: 1px solid #444;
            color: #e0e0e0;
            border-radius: 5px;
        }
        
        .value-display {
            text-align: right;
            color: #888;
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }
        
        .btn {
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            width: 100%;
            margin-top: 0.5rem;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(147, 51, 234, 0.3);
        }
        
        .btn-secondary {
            background: transparent;
            border: 1px solid #9333ea;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .metric {
            background: rgba(147, 51, 234, 0.1);
            border: 1px solid rgba(147, 51, 234, 0.3);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.3rem;
            color: #9333ea;
            font-weight: bold;
        }
        
        .metric-label {
            color: #888;
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }
        
        .warning-box {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .warning-box i {
            color: #f59e0b;
            margin-right: 0.5rem;
        }
        
        .viz-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        
        .status-bar {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10b981;
        }
        
        .status-indicator.simulating {
            background: #f59e0b;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>EUV Lithography Laboratory</h1>
            <p>13.5nm Extreme Ultraviolet • Reflective Optics • Stochastic Effects • Next-Generation Technology</p>
        </div>
        
        <div class="metrics-grid">
            <div class="metric">
                <div class="metric-value" id="resolution">7</div>
                <div class="metric-label">Resolution (nm)</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="source-power">250</div>
                <div class="metric-label">Source Power (W)</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="dose">30</div>
                <div class="metric-label">Dose (mJ/cm²)</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="throughput">125</div>
                <div class="metric-label">WPH</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="stochastic">2.5</div>
                <div class="metric-label">LER (nm)</div>
            </div>
        </div>
        
        <div class="euv-layout">
            <div class="control-panel">
                <h3 class="panel-title">
                    <i class="fas fa-atom"></i> EUV System Parameters
                </h3>
                
                <div class="control-group">
                    <label>Wavelength</label>
                    <input type="text" value="13.5 nm" disabled style="background: #333;">
                </div>
                
                <div class="control-group">
                    <label>NA: <span id="na-val">0.33</span></label>
                    <input type="range" id="na" min="0.25" max="0.55" step="0.01" value="0.33" oninput="updateValue('na'); runEUVSimulation()">
                </div>
                
                <div class="control-group">
                    <label>Reduction Ratio</label>
                    <select id="reduction">
                        <option value="4">4:1</option>
                        <option value="8">8:1</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>Source Power (W): <span id="power-val">250</span></label>
                    <input type="range" id="power" min="100" max="500" step="10" value="250" oninput="updateValue('power'); runEUVSimulation()">
                </div>
                
                <div class="control-group">
                    <label>Exposure Dose (mJ/cm²): <span id="dose-val">30</span></label>
                    <input type="range" id="dose-input" min="10" max="100" value="30" oninput="updateValue('dose-input'); runEUVSimulation()">
                </div>
                
                <h3 class="panel-title" style="margin-top: 2rem;">
                    <i class="fas fa-layer-group"></i> Mask Properties
                </h3>
                
                <div class="control-group">
                    <label>Absorber Thickness (nm): <span id="absorber-val">70</span></label>
                    <input type="range" id="absorber" min="50" max="100" value="70" oninput="updateValue('absorber'); runEUVSimulation()">
                </div>
                
                <div class="control-group">
                    <label>ML Reflectivity (%): <span id="reflectivity-val">67</span></label>
                    <input type="range" id="reflectivity" min="60" max="70" value="67" oninput="updateValue('reflectivity'); runEUVSimulation()">
                </div>
                
                <div class="control-group">
                    <label>Chief Ray Angle (°): <span id="cra-val">6</span></label>
                    <input type="range" id="cra" min="4" max="8" value="6" oninput="updateValue('cra'); runEUVSimulation()">
                </div>
                
                <h3 class="panel-title" style="margin-top: 2rem;">
                    <i class="fas fa-dice"></i> Stochastic Effects
                </h3>
                
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="shot-noise" checked onchange="runEUVSimulation()">
                        Shot Noise
                    </label>
                </div>
                
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="ler" checked onchange="runEUVSimulation()">
                        Line Edge Roughness
                    </label>
                </div>
                
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="flare" checked onchange="runEUVSimulation()">
                        Flare Effects
                    </label>
                </div>
                
                <button class="btn" onclick="runEUVSimulation()">
                    <i class="fas fa-play"></i> Run Simulation
                </button>
                
                <button class="btn btn-secondary" onclick="optimizeForNode()">
                    <i class="fas fa-magic"></i> Optimize for 3nm
                </button>
                
                <button class="btn btn-secondary" onclick="exportResults()">
                    <i class="fas fa-download"></i> Export Results
                </button>
            </div>
            
            <div class="viz-area">
                <div class="warning-box">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>EUV Challenges:</strong> Stochastic effects become dominant below 10nm features. 
                    Shot noise and photon statistics limit achievable resolution and uniformity.
                </div>
                
                <div class="viz-grid">
                    <div class="viz-panel">
                        <h3 class="panel-title">
                            <i class="fas fa-layer-group"></i> Mask Pattern (4X)
                        </h3>
                        <div id="mask-pattern"></div>
                    </div>
                    
                    <div class="viz-panel">
                        <h3 class="panel-title">
                            <i class="fas fa-image"></i> Aerial Image (1X)
                        </h3>
                        <div id="aerial-image"></div>
                    </div>
                    
                    <div class="viz-panel">
                        <h3 class="panel-title">
                            <i class="fas fa-chart-bar"></i> Photon Statistics
                        </h3>
                        <div id="photon-stats"></div>
                    </div>
                    
                    <div class="viz-panel">
                        <h3 class="panel-title">
                            <i class="fas fa-wave-square"></i> Line Edge Roughness
                        </h3>
                        <div id="ler-plot"></div>
                    </div>
                </div>
                
                <div class="viz-panel">
                    <h3 class="panel-title">
                        <i class="fas fa-bullseye"></i> 3D Mask Effects
                    </h3>
                    <div id="mask-3d"></div>
                </div>
                
                <div class="status-bar">
                    <span class="status-indicator" id="status"></span>
                    <span id="status-text">Ready</span>
                    <span style="margin-left: auto;">Simulation Time: <span id="sim-time">0</span> ms</span>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let euvData = null;
        let isSimulating = false;
        
        function updateValue(param) {
            const element = document.getElementById(
                param === 'dose-input' ? 'dose-input' : param
            );
            const value = element.value;
            document.getElementById(param.replace('-input', '') + '-val').textContent = value;
        }
        
        async function runEUVSimulation() {
            if (isSimulating) return;
            isSimulating = true;
            
            const startTime = Date.now();
            
            // Update status
            document.getElementById('status').classList.add('simulating');
            document.getElementById('status-text').textContent = 'Simulating EUV exposure...';
            
            // Get parameters
            const NA = parseFloat(document.getElementById('na').value);
            const power = parseFloat(document.getElementById('power').value);
            const dose = parseFloat(document.getElementById('dose-input').value);
            const absorberThickness = parseFloat(document.getElementById('absorber').value);
            const reflectivity = parseFloat(document.getElementById('reflectivity').value);
            const cra = parseFloat(document.getElementById('cra').value);
            const shotNoise = document.getElementById('shot-noise').checked;
            const lerEnabled = document.getElementById('ler').checked;
            const flareEnabled = document.getElementById('flare').checked;
            
            // Simulate EUV lithography
            euvData = await simulateEUV({
                NA, power, dose, absorberThickness, reflectivity, cra,
                shotNoise, lerEnabled, flareEnabled
            });
            
            // Update metrics
            updateMetrics(euvData);
            
            // Update visualizations
            updateVisualizations(euvData);
            
            // Update status
            const simTime = Date.now() - startTime;
            document.getElementById('sim-time').textContent = simTime;
            document.getElementById('status').classList.remove('simulating');
            document.getElementById('status-text').textContent = 'Simulation Complete';
            
            isSimulating = false;
        }
        
        async function simulateEUV(params) {
            // Simulate computation time
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const wavelength = 13.5; // nm
            const k1 = 0.35; // EUV k1 factor
            
            // Calculate resolution
            const resolution = k1 * wavelength / params.NA;
            
            // Calculate throughput
            const throughput = Math.round(params.power / 2); // Simplified WPH calculation
            
            // Generate mask pattern (4X)
            const maskPattern = generateMaskPattern();
            
            // Generate aerial image with EUV-specific effects
            const aerialImage = generateAerialImage(maskPattern, params);
            
            // Calculate photon statistics
            const photonStats = calculatePhotonStatistics(params.dose, params.power);
            
            // Calculate LER
            const ler = calculateLER(params.shotNoise, params.dose);
            
            return {
                resolution,
                throughput,
                maskPattern,
                aerialImage,
                photonStats,
                ler,
                params
            };
        }
        
        function generateMaskPattern() {
            const size = 100;
            const pattern = [];
            
            for (let i = 0; i < size; i++) {
                let row = [];
                for (let j = 0; j < size; j++) {
                    // Generate test pattern (lines at 4X scale)
                    let value = 0;
                    
                    // Vertical lines
                    if (j % 32 < 16) {
                        value = 1;
                    }
                    
                    // Add some complex features
                    if (i > 40 && i < 60 && j > 40 && j < 60) {
                        value = ((i + j) % 20 < 10) ? 1 : 0;
                    }
                    
                    row.push(value);
                }
                pattern.push(row);
            }
            
            return pattern;
        }
        
        function generateAerialImage(mask, params) {
            const size = mask.length;
            const reduction = 4; // 4:1 reduction
            const imageSize = size / reduction;
            const aerial = [];
            
            for (let i = 0; i < imageSize; i++) {
                let row = [];
                for (let j = 0; j < imageSize; j++) {
                    // Map to mask coordinates
                    const mi = i * reduction;
                    const mj = j * reduction;
                    
                    // Get mask value with averaging
                    let sum = 0;
                    for (let di = 0; di < reduction; di++) {
                        for (let dj = 0; dj < reduction; dj++) {
                            sum += mask[mi + di]?.[mj + dj] || 0;
                        }
                    }
                    let intensity = sum / (reduction * reduction);
                    
                    // Apply EUV-specific effects
                    
                    // 3D mask effects (shadowing)
                    const shadowEffect = Math.cos(params.cra * Math.PI / 180);
                    intensity *= shadowEffect;
                    
                    // Flare
                    if (params.flareEnabled) {
                        intensity += 0.02; // 2% flare
                    }
                    
                    // Shot noise
                    if (params.shotNoise) {
                        const photons = params.dose * 1000; // Simplified photon count
                        const noise = Math.sqrt(photons) / photons;
                        intensity += (Math.random() - 0.5) * noise * 0.1;
                    }
                    
                    row.push(Math.max(0, Math.min(1, intensity)));
                }
                aerial.push(row);
            }
            
            return aerial;
        }
        
        function calculatePhotonStatistics(dose, power) {
            const photonsPerPixel = dose * 1000; // Simplified calculation
            const distribution = [];
            
            // Generate Poisson distribution
            for (let k = 0; k < 50; k++) {
                const lambda = photonsPerPixel / 10;
                const prob = Math.exp(-lambda) * Math.pow(lambda, k) / factorial(k);
                distribution.push({ photons: k * 10, probability: prob });
            }
            
            return distribution;
        }
        
        function factorial(n) {
            if (n <= 1) return 1;
            return n * factorial(n - 1);
        }
        
        function calculateLER(shotNoise, dose) {
            // Base LER
            let ler = 2.0; // nm
            
            // Shot noise contribution
            if (shotNoise) {
                ler += 5 / Math.sqrt(dose); // Inverse sqrt of dose
            }
            
            return ler;
        }
        
        function updateMetrics(data) {
            document.getElementById('resolution').textContent = data.resolution.toFixed(1);
            document.getElementById('source-power').textContent = data.params.power;
            document.getElementById('dose').textContent = data.params.dose;
            document.getElementById('throughput').textContent = data.throughput;
            document.getElementById('stochastic').textContent = data.ler.toFixed(1);
        }
        
        function updateVisualizations(data) {
            plotMaskPattern(data.maskPattern);
            plotAerialImage(data.aerialImage);
            plotPhotonStatistics(data.photonStats);
            plotLER(data.ler);
            plot3DMaskEffects(data.params);
        }
        
        function plotMaskPattern(pattern) {
            Plotly.newPlot('mask-pattern', [{
                z: pattern,
                type: 'heatmap',
                colorscale: [[0, '#000'], [1, '#9333ea']],
                showscale: false
            }], {
                title: 'EUV Mask (TaN Absorber on ML)',
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' },
                xaxis: { title: 'X (4X scale)', showgrid: false },
                yaxis: { title: 'Y (4X scale)', showgrid: false }
            });
        }
        
        function plotAerialImage(aerial) {
            Plotly.newPlot('aerial-image', [{
                z: aerial,
                type: 'heatmap',
                colorscale: 'Hot',
                showscale: true
            }], {
                title: 'Wafer-Level Aerial Image',
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' },
                xaxis: { title: 'X (1X scale)', showgrid: false },
                yaxis: { title: 'Y (1X scale)', showgrid: false }
            });
        }
        
        function plotPhotonStatistics(stats) {
            const x = stats.map(s => s.photons);
            const y = stats.map(s => s.probability);
            
            Plotly.newPlot('photon-stats', [{
                x: x,
                y: y,
                type: 'bar',
                marker: { color: '#9333ea' }
            }], {
                title: 'Photon Distribution (Poisson)',
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' },
                xaxis: { title: 'Photons per pixel' },
                yaxis: { title: 'Probability' }
            });
        }
        
        function plotLER(lerValue) {
            // Generate line edge with roughness
            const x = [];
            const y = [];
            
            for (let i = 0; i < 100; i++) {
                x.push(i);
                const edge = 50 + lerValue * (Math.random() - 0.5) * 2;
                y.push(edge);
            }
            
            // Calculate 3-sigma
            const mean = y.reduce((a, b) => a + b) / y.length;
            const variance = y.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / y.length;
            const sigma3 = 3 * Math.sqrt(variance);
            
            Plotly.newPlot('ler-plot', [{
                x: x,
                y: y,
                type: 'scatter',
                mode: 'lines',
                line: { color: '#9333ea', width: 2 },
                name: 'Line Edge'
            }, {
                x: [0, 100],
                y: [mean, mean],
                type: 'scatter',
                mode: 'lines',
                line: { color: '#10b981', width: 1, dash: 'dash' },
                name: 'Mean'
            }], {
                title: `LER: ${lerValue.toFixed(1)}nm (3σ = ${sigma3.toFixed(1)}nm)`,
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' },
                xaxis: { title: 'Position along line' },
                yaxis: { title: 'Edge position (nm)' },
                showlegend: true
            });
        }
        
        function plot3DMaskEffects(params) {
            // Generate 3D visualization of mask shadowing
            const size = 50;
            const x = [], y = [], z = [];
            
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    x.push(i);
                    y.push(j);
                    
                    // Calculate height based on absorber pattern
                    const isAbsorber = (i % 10 < 5);
                    const height = isAbsorber ? params.absorberThickness : 0;
                    
                    // Add shadowing effect
                    const shadow = height * Math.tan(params.cra * Math.PI / 180);
                    z.push(height + shadow * (j - size/2) / size);
                }
            }
            
            Plotly.newPlot('mask-3d', [{
                x: x,
                y: y,
                z: z,
                type: 'scatter3d',
                mode: 'markers',
                marker: {
                    size: 2,
                    color: z,
                    colorscale: 'Viridis'
                }
            }], {
                title: '3D Mask Topography & Shadowing',
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' },
                scene: {
                    xaxis: { title: 'X' },
                    yaxis: { title: 'Y' },
                    zaxis: { title: 'Height (nm)' },
                    camera: {
                        eye: { x: 1.5, y: 1.5, z: 1.5 }
                    }
                }
            });
        }
        
        function optimizeForNode() {
            // Set parameters for 3nm node
            document.getElementById('na').value = 0.55;
            document.getElementById('power').value = 500;
            document.getElementById('dose-input').value = 50;
            document.getElementById('absorber').value = 60;
            
            updateValue('na');
            updateValue('power');
            updateValue('dose-input');
            updateValue('absorber');
            
            runEUVSimulation();
        }
        
        function exportResults() {
            if (!euvData) {
                alert('Run simulation first');
                return;
            }
            
            const results = {
                parameters: euvData.params,
                metrics: {
                    resolution: euvData.resolution,
                    throughput: euvData.throughput,
                    ler: euvData.ler
                },
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'euv_simulation.json';
            a.click();
        }
        
        // Initialize on load
        window.onload = function() {
            runEUVSimulation();
        };
    </script>
</body>
</html>