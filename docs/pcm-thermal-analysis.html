<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCM Thermal Analysis - 3D Heat Distribution Visualization</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a2a 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .header {
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(147, 51, 234, 0.3);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-btn {
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-title {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #9333ea, #c084fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 3rem;
        }

        .visualization-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .controls-panel {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(147, 51, 234, 0.2);
            border-radius: 15px;
            padding: 2rem;
            height: fit-content;
        }

        .viz-panel {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(147, 51, 234, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            min-height: 600px;
        }

        .control-group {
            margin-bottom: 1.5rem;
        }

        .control-label {
            display: block;
            color: #c084fc;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .control-value {
            color: #9333ea;
            font-weight: bold;
            float: right;
        }

        .control-slider {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 5px;
            background: rgba(147, 51, 234, 0.2);
            outline: none;
            border-radius: 5px;
            margin-top: 0.5rem;
        }

        .control-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #9333ea;
            cursor: pointer;
            border-radius: 50%;
        }

        .btn {
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 1rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(147, 51, 234, 0.4);
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(147, 51, 234, 0.2);
        }

        .tab {
            padding: 1rem 2rem;
            background: transparent;
            border: none;
            color: #a0a0a0;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab.active {
            color: #c084fc;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #9333ea, #c084fc);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .thermal-info {
            background: rgba(147, 51, 234, 0.1);
            border: 1px solid rgba(147, 51, 234, 0.3);
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(147, 51, 234, 0.1);
        }

        #three-canvas {
            width: 100%;
            height: 500px;
            border-radius: 10px;
            background: radial-gradient(ellipse at center, rgba(147, 51, 234, 0.1) 0%, rgba(0, 0, 0, 0.5) 100%);
        }

        .array-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .cell-display {
            background: rgba(30, 30, 30, 0.8);
            border: 1px solid rgba(147, 51, 234, 0.2);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }

        .cell-temp {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff6b6b;
        }

        .cell-label {
            color: #a0a0a0;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        @media (max-width: 1024px) {
            .visualization-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h2 style="color: #c084fc;">Thermal Analysis & Heat Distribution</h2>
            <a href="pcm-complete-project.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Back to PCM Suite
            </a>
        </div>
    </header>

    <main class="main-content">
        <h1 class="page-title">3D Thermal Profile Visualization</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('single')">Single Cell</button>
            <button class="tab" onclick="switchTab('array')">Array Crosstalk</button>
            <button class="tab" onclick="switchTab('transient')">Transient Analysis</button>
            <button class="tab" onclick="switchTab('optimization')">Thermal Optimization</button>
        </div>

        <div id="single" class="tab-content active">
            <div class="visualization-container">
                <div class="controls-panel">
                    <h3 style="color: #c084fc; margin-bottom: 1.5rem;">Thermal Parameters</h3>
                    
                    <div class="control-group">
                        <label class="control-label">
                            Applied Power (mW)
                            <span class="control-value" id="power-value">10</span>
                        </label>
                        <input type="range" class="control-slider" id="power-slider" 
                               min="1" max="50" value="10" step="1">
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">
                            Thermal Resistance (K/W)
                            <span class="control-value" id="rth-value">1e7</span>
                        </label>
                        <input type="range" class="control-slider" id="rth-slider" 
                               min="6" max="8" value="7" step="0.1">
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">
                            Thermal Capacitance (pJ/K)
                            <span class="control-value" id="cth-value">1.0</span>
                        </label>
                        <input type="range" class="control-slider" id="cth-slider" 
                               min="0.1" max="10" value="1.0" step="0.1">
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">
                            Ambient Temperature (K)
                            <span class="control-value" id="tamb-value">300</span>
                        </label>
                        <input type="range" class="control-slider" id="tamb-slider" 
                               min="250" max="400" value="300" step="10">
                    </div>
                    
                    <button class="btn" onclick="updateThermalProfile()">
                        <i class="fas fa-sync"></i> Update Simulation
                    </button>
                    
                    <button class="btn" style="background: transparent; border: 2px solid #9333ea; color: #9333ea;" 
                            onclick="animate3D()">
                        <i class="fas fa-play"></i> Animate 3D View
                    </button>
                    
                    <div class="thermal-info">
                        <h4 style="color: #c084fc;">Thermal Analysis</h4>
                        <div class="info-grid">
                            <div class="info-item">
                                <span style="color: #a0a0a0;">Peak Temp</span>
                                <span style="color: #ff6b6b; font-weight: bold;" id="peak-temp">--</span>
                            </div>
                            <div class="info-item">
                                <span style="color: #a0a0a0;">ΔT</span>
                                <span style="color: #ff6b6b; font-weight: bold;" id="delta-t">--</span>
                            </div>
                            <div class="info-item">
                                <span style="color: #a0a0a0;">Time Const</span>
                                <span style="color: #9333ea; font-weight: bold;" id="time-const">--</span>
                            </div>
                            <div class="info-item">
                                <span style="color: #a0a0a0;">State</span>
                                <span style="color: #9333ea; font-weight: bold;" id="thermal-state">--</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="viz-panel">
                    <canvas id="three-canvas"></canvas>
                    <div id="thermal-plot" style="margin-top: 2rem;"></div>
                </div>
            </div>
        </div>

        <div id="array" class="tab-content">
            <div class="viz-panel">
                <div id="array-heatmap"></div>
                
                <div class="array-grid">
                    <div class="cell-display">
                        <div class="cell-temp" id="cell-00">300 K</div>
                        <div class="cell-label">Cell [0,0]</div>
                    </div>
                    <div class="cell-display">
                        <div class="cell-temp" id="cell-01">300 K</div>
                        <div class="cell-label">Cell [0,1]</div>
                    </div>
                    <div class="cell-display">
                        <div class="cell-temp" id="cell-10">300 K</div>
                        <div class="cell-label">Cell [1,0]</div>
                    </div>
                    <div class="cell-display">
                        <div class="cell-temp" id="cell-11">300 K</div>
                        <div class="cell-label">Cell [1,1]</div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn" style="width: auto; padding: 0.75rem 2rem;" onclick="simulateCrosstalk()">
                        <i class="fas fa-fire"></i> Simulate Thermal Crosstalk
                    </button>
                </div>
            </div>
        </div>

        <div id="transient" class="tab-content">
            <div class="viz-panel">
                <div id="transient-plot"></div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 2rem;">
                    <div class="control-group">
                        <label class="control-label">
                            Pulse Duration (ns)
                            <span class="control-value" id="pulse-duration-value">100</span>
                        </label>
                        <input type="range" class="control-slider" id="pulse-duration-slider" 
                               min="10" max="1000" value="100" step="10">
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">
                            Pulse Power (mW)
                            <span class="control-value" id="pulse-power-value">20</span>
                        </label>
                        <input type="range" class="control-slider" id="pulse-power-slider" 
                               min="5" max="100" value="20" step="5">
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn" style="width: auto; padding: 0.75rem 2rem;" onclick="simulateTransient()">
                        <i class="fas fa-chart-line"></i> Run Transient Simulation
                    </button>
                </div>
            </div>
        </div>

        <div id="optimization" class="tab-content">
            <div class="viz-panel">
                <h3 style="color: #c084fc; text-align: center; margin-bottom: 2rem;">Thermal Design Optimization</h3>
                
                <div id="optimization-plot"></div>
                
                <div style="background: rgba(30, 30, 30, 0.8); border-radius: 15px; padding: 2rem; margin-top: 2rem;">
                    <h4 style="color: #c084fc; margin-bottom: 1rem;">Optimization Results</h4>
                    <p style="color: #a0a0a0; line-height: 1.8;">
                        Based on the thermal analysis, the optimal design parameters are:
                    </p>
                    <ul style="color: #e0e0e0; margin-top: 1rem; list-style: none;">
                        <li style="padding: 0.5rem 0; border-bottom: 1px solid rgba(147, 51, 234, 0.1);">
                            <i class="fas fa-check" style="color: #9333ea; margin-right: 0.5rem;"></i>
                            Thermal barrier thickness: <span style="color: #c084fc; font-weight: bold;">50 nm</span>
                        </li>
                        <li style="padding: 0.5rem 0; border-bottom: 1px solid rgba(147, 51, 234, 0.1);">
                            <i class="fas fa-check" style="color: #9333ea; margin-right: 0.5rem;"></i>
                            Heat sink material: <span style="color: #c084fc; font-weight: bold;">Cu with TiN barrier</span>
                        </li>
                        <li style="padding: 0.5rem 0; border-bottom: 1px solid rgba(147, 51, 234, 0.1);">
                            <i class="fas fa-check" style="color: #9333ea; margin-right: 0.5rem;"></i>
                            Cell spacing: <span style="color: #c084fc; font-weight: bold;">200 nm minimum</span>
                        </li>
                        <li style="padding: 0.5rem 0;">
                            <i class="fas fa-check" style="color: #9333ea; margin-right: 0.5rem;"></i>
                            Thermal time constant: <span style="color: #c084fc; font-weight: bold;">10 ns</span>
                        </li>
                    </ul>
                </div>
                
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn" style="width: auto; padding: 0.75rem 2rem;" onclick="runOptimization()">
                        <i class="fas fa-cogs"></i> Run Optimization Algorithm
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let scene, camera, renderer, heatMesh;
        let animationId;
        
        // Initialize on load
        window.addEventListener('load', () => {
            init3DThermal();
            updateThermalProfile();
            initArrayHeatmap();
            initTransientPlot();
            initOptimizationPlot();
        });

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            // Update visualizations
            if (tabName === 'array') updateArrayHeatmap();
            if (tabName === 'transient') updateTransientPlot();
            if (tabName === 'optimization') updateOptimizationPlot();
        }

        function init3DThermal() {
            const canvas = document.getElementById('three-canvas');
            scene = new THREE.Scene();
            
            camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
            camera.position.set(5, 5, 5);
            camera.lookAt(0, 0, 0);
            
            renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            
            // Create heat distribution geometry
            const geometry = new THREE.SphereGeometry(2, 32, 32);
            const material = new THREE.ShaderMaterial({
                uniforms: {
                    time: { value: 0 },
                    temperature: { value: 500 }
                },
                vertexShader: `
                    varying vec3 vPosition;
                    void main() {
                        vPosition = position;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    uniform float time;
                    uniform float temperature;
                    varying vec3 vPosition;
                    
                    void main() {
                        float dist = length(vPosition);
                        float heat = 1.0 - smoothstep(0.0, 2.0, dist);
                        heat *= (temperature - 300.0) / 600.0;
                        
                        vec3 coldColor = vec3(0.0, 0.0, 1.0);
                        vec3 hotColor = vec3(1.0, 0.0, 0.0);
                        vec3 color = mix(coldColor, hotColor, heat);
                        
                        gl_FragColor = vec4(color, 0.8);
                    }
                `,
                transparent: true
            });
            
            heatMesh = new THREE.Mesh(geometry, material);
            scene.add(heatMesh);
            
            // Add grid
            const gridHelper = new THREE.GridHelper(10, 10, 0x9333ea, 0x333333);
            scene.add(gridHelper);
            
            // Add lighting
            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);
            
            animate3DScene();
        }

        function animate3DScene() {
            animationId = requestAnimationFrame(animate3DScene);
            
            if (heatMesh) {
                heatMesh.material.uniforms.time.value += 0.01;
                heatMesh.rotation.y += 0.005;
            }
            
            renderer.render(scene, camera);
        }

        function animate3D() {
            let angle = 0;
            const interval = setInterval(() => {
                angle += 2;
                camera.position.x = 5 * Math.cos(angle * Math.PI / 180);
                camera.position.z = 5 * Math.sin(angle * Math.PI / 180);
                camera.lookAt(0, 0, 0);
                
                if (angle >= 360) {
                    clearInterval(interval);
                }
            }, 20);
        }

        function updateThermalProfile() {
            const power = parseFloat(document.getElementById('power-slider').value);
            const Rth = Math.pow(10, parseFloat(document.getElementById('rth-slider').value));
            const Cth = parseFloat(document.getElementById('cth-slider').value) * 1e-12;
            const Tamb = parseFloat(document.getElementById('tamb-slider').value);
            
            // Calculate steady-state temperature
            const deltaT = power * 1e-3 * Rth;
            const Tpeak = Tamb + deltaT;
            const timeConst = Rth * Cth * 1e9; // Convert to ns
            
            // Update display
            document.getElementById('peak-temp').textContent = Tpeak.toFixed(0) + ' K';
            document.getElementById('delta-t').textContent = deltaT.toFixed(0) + ' K';
            document.getElementById('time-const').textContent = timeConst.toFixed(1) + ' ns';
            
            let state = 'Safe';
            if (Tpeak > 900) state = 'Melting';
            else if (Tpeak > 600) state = 'Critical';
            else if (Tpeak > 450) state = 'Crystallizing';
            document.getElementById('thermal-state').textContent = state;
            
            // Update 3D visualization
            if (heatMesh) {
                heatMesh.material.uniforms.temperature.value = Tpeak;
            }
            
            // Generate radial temperature profile
            const r = [];
            const T = [];
            for (let i = 0; i <= 100; i++) {
                const radius = i * 0.01; // 0 to 1 µm
                r.push(radius);
                // Gaussian temperature distribution
                const temp = Tamb + deltaT * Math.exp(-radius * radius / 0.1);
                T.push(temp);
            }
            
            const trace = {
                x: r,
                y: T,
                type: 'scatter',
                mode: 'lines',
                line: {
                    color: T,
                    colorscale: [
                        [0, '#0000ff'],
                        [0.5, '#9333ea'],
                        [1, '#ff0000']
                    ],
                    width: 3
                },
                fill: 'tozeroy',
                fillcolor: 'rgba(147, 51, 234, 0.1)'
            };
            
            const layout = {
                title: 'Radial Temperature Profile',
                xaxis: { 
                    title: 'Distance from Center (µm)',
                    gridcolor: '#333'
                },
                yaxis: { 
                    title: 'Temperature (K)',
                    gridcolor: '#333'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' },
                shapes: [
                    {
                        type: 'line',
                        x0: 0, x1: 1,
                        y0: 900, y1: 900,
                        line: { color: 'rgba(255, 0, 0, 0.5)', width: 1, dash: 'dash' }
                    },
                    {
                        type: 'line',
                        x0: 0, x1: 1,
                        y0: 450, y1: 450,
                        line: { color: 'rgba(0, 255, 0, 0.5)', width: 1, dash: 'dash' }
                    }
                ],
                annotations: [
                    {
                        x: 0.9, y: 900,
                        text: 'T<sub>melt</sub>',
                        showarrow: false,
                        font: { color: '#ff6b6b', size: 10 }
                    },
                    {
                        x: 0.9, y: 450,
                        text: 'T<sub>cryst</sub>',
                        showarrow: false,
                        font: { color: '#6bff6b', size: 10 }
                    }
                ]
            };
            
            Plotly.newPlot('thermal-plot', [trace], layout, {responsive: true});
        }

        function initArrayHeatmap() {
            updateArrayHeatmap();
        }

        function updateArrayHeatmap() {
            // Create 4x4 array heatmap
            const size = 4;
            const z = [];
            for (let i = 0; i < size; i++) {
                const row = [];
                for (let j = 0; j < size; j++) {
                    // Simulate temperature with some cells being programmed
                    const isProgrammed = (i === 1 && j === 1) || (i === 2 && j === 2);
                    const temp = isProgrammed ? 600 + Math.random() * 300 : 300 + Math.random() * 50;
                    row.push(temp);
                }
                z.push(row);
            }
            
            const data = [{
                type: 'heatmap',
                z: z,
                colorscale: [
                    [0, '#0000ff'],
                    [0.3, '#00ff00'],
                    [0.6, '#ffff00'],
                    [1, '#ff0000']
                ],
                showscale: true,
                colorbar: {
                    title: 'T (K)',
                    titleside: 'right'
                }
            }];
            
            const layout = {
                title: 'PCM Array Thermal Map',
                xaxis: { title: 'Column', gridcolor: '#333' },
                yaxis: { title: 'Row', gridcolor: '#333' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' }
            };
            
            Plotly.newPlot('array-heatmap', data, layout, {responsive: true});
        }

        function simulateCrosstalk() {
            // Simulate thermal crosstalk between cells
            const cells = {
                '00': 300,
                '01': 300,
                '10': 300,
                '11': 800  // Programmed cell
            };
            
            // Calculate crosstalk
            cells['01'] = 300 + (cells['11'] - 300) * 0.2;  // 20% crosstalk
            cells['10'] = 300 + (cells['11'] - 300) * 0.2;
            cells['00'] = 300 + (cells['11'] - 300) * 0.1;  // 10% diagonal crosstalk
            
            // Update display
            Object.keys(cells).forEach(key => {
                document.getElementById(`cell-${key}`).textContent = cells[key].toFixed(0) + ' K';
                document.getElementById(`cell-${key}`).style.color = 
                    cells[key] > 600 ? '#ff0000' : 
                    cells[key] > 400 ? '#ff6b6b' : '#4ecdc4';
            });
            
            updateArrayHeatmap();
        }

        function initTransientPlot() {
            updateTransientPlot();
        }

        function updateTransientPlot() {
            const layout = {
                title: 'Click "Run Transient Simulation" to start',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' }
            };
            
            Plotly.newPlot('transient-plot', [], layout, {responsive: true});
        }

        function simulateTransient() {
            const duration = parseFloat(document.getElementById('pulse-duration-slider').value);
            const power = parseFloat(document.getElementById('pulse-power-slider').value);
            
            // Generate time array
            const time = [];
            const temperature = [];
            const Tamb = 300;
            const Rth = 1e7;
            const Cth = 1e-15;
            const tau = Rth * Cth * 1e9; // ns
            
            for (let t = 0; t <= duration * 3; t += 0.5) {
                time.push(t);
                
                let T;
                if (t < duration) {
                    // Heating phase
                    T = Tamb + power * 1e-3 * Rth * (1 - Math.exp(-t / tau));
                } else {
                    // Cooling phase
                    const Tmax = Tamb + power * 1e-3 * Rth * (1 - Math.exp(-duration / tau));
                    T = Tamb + (Tmax - Tamb) * Math.exp(-(t - duration) / tau);
                }
                temperature.push(T);
            }
            
            const trace = {
                x: time,
                y: temperature,
                type: 'scatter',
                mode: 'lines',
                line: { color: '#ff6b6b', width: 2 },
                fill: 'tozeroy',
                fillcolor: 'rgba(255, 107, 107, 0.1)'
            };
            
            const layout = {
                title: 'Transient Thermal Response',
                xaxis: { title: 'Time (ns)', gridcolor: '#333' },
                yaxis: { title: 'Temperature (K)', gridcolor: '#333' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' },
                shapes: [
                    {
                        type: 'rect',
                        x0: 0, x1: duration,
                        y0: 0, y1: Math.max(...temperature),
                        fillcolor: 'rgba(147, 51, 234, 0.1)',
                        line: { width: 0 }
                    }
                ],
                annotations: [
                    {
                        x: duration / 2,
                        y: Math.max(...temperature) * 0.95,
                        text: 'Pulse ON',
                        showarrow: false,
                        font: { color: '#c084fc' }
                    }
                ]
            };
            
            Plotly.newPlot('transient-plot', [trace], layout, {responsive: true});
        }

        function initOptimizationPlot() {
            updateOptimizationPlot();
        }

        function updateOptimizationPlot() {
            // Create Pareto front for thermal optimization
            const x = [];  // Thermal resistance
            const y = [];  // Power consumption
            
            for (let i = 0; i < 50; i++) {
                const rth = 1e6 + i * 2e5;
                const power = 100 / (rth / 1e6);  // Inverse relationship
                x.push(rth / 1e6);
                y.push(power);
            }
            
            const trace = {
                x: x,
                y: y,
                type: 'scatter',
                mode: 'lines+markers',
                marker: {
                    size: 8,
                    color: y,
                    colorscale: [
                        [0, '#00ff00'],
                        [0.5, '#ffff00'],
                        [1, '#ff0000']
                    ],
                    showscale: true,
                    colorbar: {
                        title: 'Power (mW)',
                        titleside: 'right'
                    }
                },
                line: { color: '#9333ea', width: 2 }
            };
            
            const layout = {
                title: 'Thermal Design Optimization Space',
                xaxis: { 
                    title: 'Thermal Resistance (MK/W)',
                    gridcolor: '#333'
                },
                yaxis: { 
                    title: 'Power Consumption (mW)',
                    gridcolor: '#333'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' },
                annotations: [
                    {
                        x: 5,
                        y: 20,
                        text: 'Optimal<br>Design Point',
                        showarrow: true,
                        arrowhead: 2,
                        arrowcolor: '#c084fc',
                        font: { color: '#c084fc' }
                    }
                ]
            };
            
            Plotly.newPlot('optimization-plot', [trace], layout, {responsive: true});
        }

        function runOptimization() {
            // Simulate optimization algorithm running
            alert('Optimization algorithm running... Finding optimal thermal design parameters.');
            updateOptimizationPlot();
        }

        // Update value displays
        document.getElementById('power-slider').addEventListener('input', function() {
            document.getElementById('power-value').textContent = this.value;
        });

        document.getElementById('rth-slider').addEventListener('input', function() {
            document.getElementById('rth-value').textContent = '1e' + this.value;
        });

        document.getElementById('cth-slider').addEventListener('input', function() {
            document.getElementById('cth-value').textContent = this.value;
        });

        document.getElementById('tamb-slider').addEventListener('input', function() {
            document.getElementById('tamb-value').textContent = this.value;
        });

        document.getElementById('pulse-duration-slider').addEventListener('input', function() {
            document.getElementById('pulse-duration-value').textContent = this.value;
        });

        document.getElementById('pulse-power-slider').addEventListener('input', function() {
            document.getElementById('pulse-power-value').textContent = this.value;
        });
    </script>
</body>
</html>