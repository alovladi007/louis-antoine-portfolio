<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCM Crystallization Dynamics - Interactive JMAK Simulator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a2a 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .header {
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(147, 51, 234, 0.3);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-btn {
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            transform: translateX(-5px);
            box-shadow: 0 5px 15px rgba(147, 51, 234, 0.4);
        }

        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .title-section {
            text-align: center;
            margin-bottom: 3rem;
        }

        .page-title {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #9333ea, #c084fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .page-subtitle {
            font-size: 1.2rem;
            color: #a0a0a0;
        }

        .simulator-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .plot-container {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(147, 51, 234, 0.2);
            border-radius: 15px;
            padding: 2rem;
            min-height: 500px;
        }

        .controls-container {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(147, 51, 234, 0.2);
            border-radius: 15px;
            padding: 2rem;
        }

        .control-group {
            margin-bottom: 2rem;
        }

        .control-label {
            display: block;
            color: #c084fc;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .control-value {
            color: #9333ea;
            font-weight: bold;
            float: right;
        }

        .control-slider {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 5px;
            background: rgba(147, 51, 234, 0.2);
            outline: none;
            border-radius: 5px;
            margin-top: 0.5rem;
        }

        .control-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #9333ea;
            cursor: pointer;
            border-radius: 50%;
        }

        .control-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #9333ea;
            cursor: pointer;
            border-radius: 50%;
        }

        .control-select {
            width: 100%;
            padding: 0.5rem;
            background: rgba(147, 51, 234, 0.1);
            border: 1px solid rgba(147, 51, 234, 0.3);
            color: #e0e0e0;
            border-radius: 8px;
            margin-top: 0.5rem;
        }

        .btn {
            background: linear-gradient(135deg, #9333ea, #7c3aed);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 1rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(147, 51, 234, 0.4);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid #9333ea;
            color: #9333ea;
        }

        .btn-secondary:hover {
            background: rgba(147, 51, 234, 0.1);
        }

        .info-panel {
            background: rgba(147, 51, 234, 0.1);
            border: 1px solid rgba(147, 51, 234, 0.3);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .info-title {
            color: #c084fc;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(147, 51, 234, 0.1);
        }

        .info-label {
            color: #a0a0a0;
        }

        .info-value {
            color: #9333ea;
            font-weight: bold;
        }

        .equation-display {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(147, 51, 234, 0.2);
            border-radius: 10px;
            padding: 1.5rem;
            margin: 2rem 0;
            text-align: center;
            font-size: 1.2rem;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(147, 51, 234, 0.2);
        }

        .tab {
            padding: 1rem 2rem;
            background: transparent;
            border: none;
            color: #a0a0a0;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab.active {
            color: #c084fc;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #9333ea, #c084fc);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 1024px) {
            .simulator-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h2 style="color: #c084fc;">Crystallization Dynamics Simulator</h2>
            <a href="pcm-complete-project.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Back to PCM Suite
            </a>
        </div>
    </header>

    <main class="main-content">
        <div class="title-section">
            <h1 class="page-title">JMAK Crystallization Kinetics</h1>
            <p class="page-subtitle">Interactive Johnson-Mehl-Avrami-Kolmogorov Model for GST Phase Transformation</p>
        </div>

        <div class="equation-display">
            <p>$$X(t) = 1 - \exp\left[-\left(k \cdot t\right)^n\right]$$</p>
            <p style="margin-top: 1rem; font-size: 1rem; color: #a0a0a0;">
                where \(k = k_0 \exp\left(-\frac{E_a}{k_B T}\right)\)
            </p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('isothermal')">Isothermal Crystallization</button>
            <button class="tab" onclick="switchTab('arrhenius')">Arrhenius Analysis</button>
            <button class="tab" onclick="switchTab('3d')">3D Phase Evolution</button>
            <button class="tab" onclick="switchTab('comparison')">Material Comparison</button>
        </div>

        <div id="isothermal" class="tab-content active">
            <div class="simulator-container">
                <div class="plot-container">
                    <div id="jmak-plot"></div>
                </div>
                
                <div class="controls-container">
                    <h3 style="color: #c084fc; margin-bottom: 1.5rem;">Simulation Parameters</h3>
                    
                    <div class="control-group">
                        <label class="control-label">
                            Activation Energy (eV)
                            <span class="control-value" id="ea-value">1.8</span>
                        </label>
                        <input type="range" class="control-slider" id="ea-slider" 
                               min="1.0" max="3.0" value="1.8" step="0.1">
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">
                            Pre-exponential Factor (log₁₀ k₀)
                            <span class="control-value" id="k0-value">16</span>
                        </label>
                        <input type="range" class="control-slider" id="k0-slider" 
                               min="10" max="20" value="16" step="0.5">
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">
                            Avrami Exponent (n)
                            <span class="control-value" id="n-value">3.0</span>
                        </label>
                        <input type="range" class="control-slider" id="n-slider" 
                               min="1.0" max="4.0" value="3.0" step="0.1">
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Temperature Range</label>
                        <select class="control-select" id="temp-range">
                            <option value="low">Low (400-500 K)</option>
                            <option value="medium" selected>Medium (450-600 K)</option>
                            <option value="high">High (500-700 K)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    
                    <button class="btn" onclick="updateJMAK()">Update Simulation</button>
                    <button class="btn btn-secondary" onclick="resetParameters()">Reset Defaults</button>
                    
                    <div class="info-panel" style="margin-top: 2rem;">
                        <div class="info-title">Crystallization Times</div>
                        <div id="crystallization-info"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="arrhenius" class="tab-content">
            <div class="simulator-container">
                <div class="plot-container">
                    <div id="arrhenius-plot"></div>
                </div>
                
                <div class="controls-container">
                    <h3 style="color: #c084fc; margin-bottom: 1.5rem;">Arrhenius Analysis</h3>
                    
                    <div class="control-group">
                        <label class="control-label">
                            Target Crystallinity (%)
                            <span class="control-value" id="target-x-value">50</span>
                        </label>
                        <input type="range" class="control-slider" id="target-x-slider" 
                               min="10" max="90" value="50" step="10">
                    </div>
                    
                    <button class="btn" onclick="updateArrhenius()">Calculate</button>
                    
                    <div class="info-panel" style="margin-top: 2rem;">
                        <div class="info-title">Extracted Parameters</div>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Ea (fitted)</span>
                                <span class="info-value" id="ea-fitted">--</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ln(k₀)</span>
                                <span class="info-value" id="lnk0-fitted">--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="3d" class="tab-content">
            <div class="plot-container" style="height: 600px;">
                <div id="3d-plot"></div>
            </div>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn" style="width: auto; padding: 0.75rem 2rem;" onclick="animate3D()">
                    <i class="fas fa-play"></i> Animate Evolution
                </button>
            </div>
        </div>

        <div id="comparison" class="tab-content">
            <div class="plot-container">
                <div id="comparison-plot"></div>
            </div>
            
            <div style="margin-top: 2rem;">
                <h3 style="color: #c084fc; margin-bottom: 1rem;">Material Database</h3>
                <table style="width: 100%; background: rgba(20, 20, 20, 0.8); border-radius: 10px; overflow: hidden;">
                    <thead>
                        <tr style="background: rgba(147, 51, 234, 0.2);">
                            <th style="padding: 1rem; text-align: left; color: #c084fc;">Material</th>
                            <th style="padding: 1rem; text-align: center; color: #c084fc;">Ea (eV)</th>
                            <th style="padding: 1rem; text-align: center; color: #c084fc;">n</th>
                            <th style="padding: 1rem; text-align: center; color: #c084fc;">Tc (K)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 1rem; border-top: 1px solid rgba(147, 51, 234, 0.1);">Ge₂Sb₂Te₅</td>
                            <td style="padding: 1rem; text-align: center; border-top: 1px solid rgba(147, 51, 234, 0.1);">1.8</td>
                            <td style="padding: 1rem; text-align: center; border-top: 1px solid rgba(147, 51, 234, 0.1);">3.0</td>
                            <td style="padding: 1rem; text-align: center; border-top: 1px solid rgba(147, 51, 234, 0.1);">430</td>
                        </tr>
                        <tr>
                            <td style="padding: 1rem; border-top: 1px solid rgba(147, 51, 234, 0.1);">GeTe</td>
                            <td style="padding: 1rem; text-align: center; border-top: 1px solid rgba(147, 51, 234, 0.1);">2.2</td>
                            <td style="padding: 1rem; text-align: center; border-top: 1px solid rgba(147, 51, 234, 0.1);">2.5</td>
                            <td style="padding: 1rem; text-align: center; border-top: 1px solid rgba(147, 51, 234, 0.1);">450</td>
                        </tr>
                        <tr>
                            <td style="padding: 1rem; border-top: 1px solid rgba(147, 51, 234, 0.1);">Sb₂Te₃</td>
                            <td style="padding: 1rem; text-align: center; border-top: 1px solid rgba(147, 51, 234, 0.1);">1.5</td>
                            <td style="padding: 1rem; text-align: center; border-top: 1px solid rgba(147, 51, 234, 0.1);">3.5</td>
                            <td style="padding: 1rem; text-align: center; border-top: 1px solid rgba(147, 51, 234, 0.1);">380</td>
                        </tr>
                        <tr>
                            <td style="padding: 1rem; border-top: 1px solid rgba(147, 51, 234, 0.1);">AIST</td>
                            <td style="padding: 1rem; text-align: center; border-top: 1px solid rgba(147, 51, 234, 0.1);">2.0</td>
                            <td style="padding: 1rem; text-align: center; border-top: 1px solid rgba(147, 51, 234, 0.1);">2.8</td>
                            <td style="padding: 1rem; text-align: center; border-top: 1px solid rgba(147, 51, 234, 0.1);">410</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // Global parameters
        let params = {
            Ea: 1.8,  // eV
            k0: 1e16,  // 1/s
            n: 3.0,    // Avrami exponent
            kb: 8.617333262e-5  // Boltzmann constant in eV/K
        };

        // Initialize plots on load
        window.addEventListener('load', () => {
            updateJMAK();
            updateArrhenius();
            update3DPlot();
            updateComparison();
        });

        // Tab switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            // Update plots when switching tabs
            if (tabName === 'arrhenius') updateArrhenius();
            if (tabName === '3d') update3DPlot();
            if (tabName === 'comparison') updateComparison();
        }

        // Update JMAK plot
        function updateJMAK() {
            const tempRange = document.getElementById('temp-range').value;
            let temps;
            
            switch(tempRange) {
                case 'low':
                    temps = [400, 425, 450, 475, 500];
                    break;
                case 'high':
                    temps = [500, 550, 600, 650, 700];
                    break;
                default:
                    temps = [450, 500, 550, 600, 650];
            }
            
            const t = [];
            for (let i = -9; i <= -2; i += 0.05) {
                t.push(Math.pow(10, i));
            }
            
            const traces = [];
            let infoHTML = '';
            
            temps.forEach(T => {
                const k = params.k0 * Math.exp(-params.Ea / (params.kb * T));
                const X = t.map(time => 1 - Math.exp(-Math.pow(k * time, params.n)));
                
                traces.push({
                    x: t,
                    y: X,
                    type: 'scatter',
                    mode: 'lines',
                    name: `${T} K`,
                    line: { width: 2 }
                });
                
                // Calculate t50
                const t50 = Math.pow(-Math.log(0.5), 1/params.n) / k;
                infoHTML += `<div class="info-item">
                    <span class="info-label">${T} K</span>
                    <span class="info-value">${formatTime(t50)}</span>
                </div>`;
            });
            
            const layout = {
                title: 'Isothermal Crystallization Kinetics',
                xaxis: { 
                    title: 'Time (s)', 
                    type: 'log',
                    gridcolor: '#333',
                    range: [-9, -2]
                },
                yaxis: { 
                    title: 'Crystalline Fraction X',
                    gridcolor: '#333',
                    range: [0, 1.05]
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' },
                showlegend: true,
                legend: {
                    x: 0.02,
                    y: 0.98,
                    bgcolor: 'rgba(0,0,0,0.5)'
                }
            };
            
            Plotly.newPlot('jmak-plot', traces, layout, {responsive: true});
            document.getElementById('crystallization-info').innerHTML = infoHTML;
        }

        // Update Arrhenius plot
        function updateArrhenius() {
            const targetX = parseFloat(document.getElementById('target-x-slider').value) / 100;
            const temps = [];
            const times = [];
            
            for (let T = 400; T <= 700; T += 20) {
                temps.push(T);
                const k = params.k0 * Math.exp(-params.Ea / (params.kb * T));
                const t = Math.pow(-Math.log(1 - targetX), 1/params.n) / k;
                times.push(t);
            }
            
            const trace = {
                x: temps.map(T => 1000/T),
                y: times,
                type: 'scatter',
                mode: 'markers+lines',
                marker: { size: 8, color: '#9333ea' },
                line: { color: '#c084fc', width: 2 }
            };
            
            const layout = {
                title: `Arrhenius Plot (${(targetX*100).toFixed(0)}% Crystallization)`,
                xaxis: { 
                    title: '1000/T (K⁻¹)',
                    gridcolor: '#333'
                },
                yaxis: { 
                    title: 'Time (s)',
                    type: 'log',
                    gridcolor: '#333'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' }
            };
            
            Plotly.newPlot('arrhenius-plot', [trace], layout, {responsive: true});
            
            // Update fitted parameters
            document.getElementById('ea-fitted').textContent = params.Ea.toFixed(2) + ' eV';
            document.getElementById('lnk0-fitted').textContent = Math.log(params.k0).toFixed(1);
        }

        // Update 3D plot
        function update3DPlot() {
            const temps = [];
            const times = [];
            const z = [];
            
            for (let T = 400; T <= 700; T += 10) {
                const row = [];
                for (let i = -9; i <= -2; i += 0.1) {
                    const t = Math.pow(10, i);
                    const k = params.k0 * Math.exp(-params.Ea / (params.kb * T));
                    const X = 1 - Math.exp(-Math.pow(k * t, params.n));
                    row.push(X);
                    if (T === 400) times.push(t);
                }
                temps.push(T);
                z.push(row);
            }
            
            const data = [{
                type: 'surface',
                x: times,
                y: temps,
                z: z,
                colorscale: [
                    [0, '#1a0a2a'],
                    [0.5, '#9333ea'],
                    [1, '#c084fc']
                ],
                showscale: true,
                colorbar: {
                    title: 'X',
                    titleside: 'right'
                }
            }];
            
            const layout = {
                title: '3D Crystallization Surface',
                scene: {
                    xaxis: {
                        title: 'Time (s)',
                        type: 'log',
                        gridcolor: '#333'
                    },
                    yaxis: {
                        title: 'Temperature (K)',
                        gridcolor: '#333'
                    },
                    zaxis: {
                        title: 'Crystalline Fraction',
                        gridcolor: '#333'
                    },
                    bgcolor: 'rgba(0,0,0,0)',
                    camera: {
                        eye: {x: 1.5, y: 1.5, z: 1.5}
                    }
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' }
            };
            
            Plotly.newPlot('3d-plot', data, layout, {responsive: true});
        }

        // Update comparison plot
        function updateComparison() {
            const materials = [
                {name: 'Ge₂Sb₂Te₅', Ea: 1.8, n: 3.0, k0: 1e16},
                {name: 'GeTe', Ea: 2.2, n: 2.5, k0: 1e17},
                {name: 'Sb₂Te₃', Ea: 1.5, n: 3.5, k0: 1e15},
                {name: 'AIST', Ea: 2.0, n: 2.8, k0: 5e15}
            ];
            
            const t = [];
            for (let i = -9; i <= -2; i += 0.05) {
                t.push(Math.pow(10, i));
            }
            
            const traces = [];
            const T = 500; // Fixed temperature for comparison
            
            materials.forEach(mat => {
                const k = mat.k0 * Math.exp(-mat.Ea / (params.kb * T));
                const X = t.map(time => 1 - Math.exp(-Math.pow(k * time, mat.n)));
                
                traces.push({
                    x: t,
                    y: X,
                    type: 'scatter',
                    mode: 'lines',
                    name: mat.name,
                    line: { width: 2 }
                });
            });
            
            const layout = {
                title: 'Material Comparison at 500 K',
                xaxis: { 
                    title: 'Time (s)', 
                    type: 'log',
                    gridcolor: '#333'
                },
                yaxis: { 
                    title: 'Crystalline Fraction X',
                    gridcolor: '#333'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#e0e0e0' },
                showlegend: true
            };
            
            Plotly.newPlot('comparison-plot', traces, layout, {responsive: true});
        }

        // Animate 3D plot
        function animate3D() {
            let angle = 0;
            const interval = setInterval(() => {
                angle += 2;
                const update = {
                    'scene.camera': {
                        eye: {
                            x: 1.5 * Math.cos(angle * Math.PI / 180),
                            y: 1.5 * Math.sin(angle * Math.PI / 180),
                            z: 1.5
                        }
                    }
                };
                Plotly.relayout('3d-plot', update);
                
                if (angle >= 360) {
                    clearInterval(interval);
                }
            }, 50);
        }

        // Helper function to format time
        function formatTime(t) {
            if (t < 1e-6) return (t * 1e9).toFixed(1) + ' ns';
            if (t < 1e-3) return (t * 1e6).toFixed(1) + ' μs';
            if (t < 1) return (t * 1e3).toFixed(1) + ' ms';
            return t.toFixed(2) + ' s';
        }

        // Update parameter values
        document.getElementById('ea-slider').addEventListener('input', function() {
            params.Ea = parseFloat(this.value);
            document.getElementById('ea-value').textContent = this.value;
            updateJMAK();
        });

        document.getElementById('k0-slider').addEventListener('input', function() {
            params.k0 = Math.pow(10, parseFloat(this.value));
            document.getElementById('k0-value').textContent = this.value;
            updateJMAK();
        });

        document.getElementById('n-slider').addEventListener('input', function() {
            params.n = parseFloat(this.value);
            document.getElementById('n-value').textContent = this.value;
            updateJMAK();
        });

        document.getElementById('target-x-slider').addEventListener('input', function() {
            document.getElementById('target-x-value').textContent = this.value;
        });

        // Reset parameters
        function resetParameters() {
            params = {
                Ea: 1.8,
                k0: 1e16,
                n: 3.0,
                kb: 8.617333262e-5
            };
            
            document.getElementById('ea-slider').value = 1.8;
            document.getElementById('ea-value').textContent = '1.8';
            document.getElementById('k0-slider').value = 16;
            document.getElementById('k0-value').textContent = '16';
            document.getElementById('n-slider').value = 3.0;
            document.getElementById('n-value').textContent = '3.0';
            
            updateJMAK();
        }
    </script>
</body>
</html>