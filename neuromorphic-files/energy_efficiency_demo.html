<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Efficiency Analysis - Interactive Demo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #e5e7eb;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .navigation-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #e5e7eb;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .nav-btn:hover {
            background: rgba(245, 158, 11, 0.2);
            border-color: #f59e0b;
            color: #f59e0b;
            transform: translateY(-2px);
        }
        
        h1 {
            text-align: center;
            color: #f59e0b;
            margin-bottom: 40px;
        }
        
        .energy-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .energy-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .energy-card:hover {
            transform: translateY(-5px);
        }
        
        .energy-icon {
            font-size: 3em;
            color: #10b981;
            margin-bottom: 15px;
        }
        
        .energy-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #10b981;
            margin-bottom: 5px;
        }
        
        .energy-label {
            color: #9ca3af;
            font-size: 1.1em;
        }
        
        .comparison-unit {
            font-size: 0.9em;
            color: #60a5fa;
            margin-top: 10px;
        }
        
        .control-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .control-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 10px;
        }
        
        .control-item label {
            display: block;
            margin-bottom: 10px;
            color: #60a5fa;
            font-weight: 600;
        }
        
        .control-item input[type="range"] {
            width: 100%;
            margin-bottom: 8px;
        }
        
        .value-display {
            text-align: center;
            background: #1f2937;
            padding: 8px;
            border-radius: 5px;
            font-family: monospace;
            color: #f59e0b;
        }
        
        .visualization-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }
        
        .viz-container {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        
        .breakdown-section {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }
        
        .breakdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .breakdown-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .breakdown-percentage {
            font-size: 2em;
            font-weight: bold;
            color: #3b82f6;
        }
        
        .breakdown-label {
            color: #9ca3af;
            margin-top: 5px;
        }
        
        .btn-calculate {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            transition: all 0.3s;
        }
        
        .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.4);
        }
        
        .insight-box {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .insight-title {
            color: #f59e0b;
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="navigation-bar">
            <a href="../neuromorphic-computing-research.html" class="nav-btn">
                <i class="fas fa-arrow-left"></i> Back to Main
            </a>
            <a href="switching_dynamics_demo.html" class="nav-btn">
                <i class="fas fa-wave-square"></i> Switching Dynamics
            </a>
            <a href="ir_drop_demo.html" class="nav-btn">
                <i class="fas fa-chart-area"></i> IR Drop Analysis
            </a>
        </div>
        
        <h1>Energy Efficiency Analysis - Memristor Neural Accelerator</h1>
        
        <div class="energy-overview">
            <div class="energy-card">
                <div class="energy-icon"><i class="fas fa-bolt"></i></div>
                <div class="energy-value" id="energyPerMAC">0.1</div>
                <div class="energy-label">pJ per MAC</div>
                <div class="comparison-unit">100Ã— better than GPU</div>
            </div>
            <div class="energy-card">
                <div class="energy-icon"><i class="fas fa-microchip"></i></div>
                <div class="energy-value" id="topsPerWatt">20</div>
                <div class="energy-label">TOPS/W</div>
                <div class="comparison-unit">Peak Efficiency</div>
            </div>
            <div class="energy-card">
                <div class="energy-icon"><i class="fas fa-battery-full"></i></div>
                <div class="energy-value" id="totalPower">10</div>
                <div class="energy-label">Watts</div>
                <div class="comparison-unit">Total Power</div>
            </div>
            <div class="energy-card">
                <div class="energy-icon"><i class="fas fa-tachometer-alt"></i></div>
                <div class="energy-value" id="peakTOPS">200</div>
                <div class="energy-label">TOPS</div>
                <div class="comparison-unit">Peak Performance</div>
            </div>
        </div>
        
        <div class="control-section">
            <h2>Neural Network Configuration</h2>
            <div class="control-grid">
                <div class="control-item">
                    <label>Network Size (Layers)</label>
                    <input type="range" id="numLayers" min="2" max="10" step="1" value="5">
                    <div class="value-display" id="numLayersValue">5 Layers</div>
                </div>
                <div class="control-item">
                    <label>Layer Width (Neurons)</label>
                    <input type="range" id="layerWidth" min="128" max="2048" step="128" value="512">
                    <div class="value-display" id="layerWidthValue">512 Neurons</div>
                </div>
                <div class="control-item">
                    <label>Batch Size</label>
                    <input type="range" id="batchSize" min="1" max="256" step="1" value="32">
                    <div class="value-display" id="batchSizeValue">32</div>
                </div>
                <div class="control-item">
                    <label>Precision (bits)</label>
                    <input type="range" id="precision" min="1" max="8" step="1" value="4">
                    <div class="value-display" id="precisionValue">4-bit</div>
                </div>
                <div class="control-item">
                    <label>Sparsity (%)</label>
                    <input type="range" id="sparsity" min="0" max="90" step="10" value="50">
                    <div class="value-display" id="sparsityValue">50%</div>
                </div>
                <div class="control-item">
                    <label>Operating Frequency (MHz)</label>
                    <input type="range" id="frequency" min="100" max="1000" step="100" value="500">
                    <div class="value-display" id="frequencyValue">500 MHz</div>
                </div>
            </div>
            <button class="btn-calculate" onclick="calculateEnergy()">Calculate Energy Efficiency</button>
        </div>
        
        <div class="visualization-section">
            <div class="viz-container">
                <div id="energyComparison"></div>
            </div>
            
            <div class="viz-container">
                <div id="scalingAnalysis"></div>
            </div>
            
            <div class="breakdown-section">
                <h2>Energy Breakdown</h2>
                <div class="breakdown-grid">
                    <div class="breakdown-item">
                        <div class="breakdown-percentage" id="computeEnergy">45%</div>
                        <div class="breakdown-label">Computation</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-percentage" id="dacAdcEnergy">30%</div>
                        <div class="breakdown-label">DAC/ADC</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-percentage" id="routingEnergy">15%</div>
                        <div class="breakdown-label">Routing</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-percentage" id="controlEnergy">10%</div>
                        <div class="breakdown-label">Control</div>
                    </div>
                </div>
                <div id="energyPie"></div>
            </div>
            
            <div class="viz-container">
                <div id="efficiencyMap"></div>
            </div>
            
            <div class="insight-box">
                <div class="insight-title">Key Insights</div>
                <div id="insights">
                    <ul>
                        <li>Analog computation eliminates data movement energy</li>
                        <li>Sparsity exploitation reduces active device count</li>
                        <li>Lower precision improves energy efficiency with minimal accuracy loss</li>
                        <li>Partitioned architecture minimizes IR drop losses</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Update display values
        document.getElementById('numLayers').addEventListener('input', (e) => {
            document.getElementById('numLayersValue').textContent = e.target.value + ' Layers';
        });
        
        document.getElementById('layerWidth').addEventListener('input', (e) => {
            document.getElementById('layerWidthValue').textContent = e.target.value + ' Neurons';
        });
        
        document.getElementById('batchSize').addEventListener('input', (e) => {
            document.getElementById('batchSizeValue').textContent = e.target.value;
        });
        
        document.getElementById('precision').addEventListener('input', (e) => {
            document.getElementById('precisionValue').textContent = e.target.value + '-bit';
        });
        
        document.getElementById('sparsity').addEventListener('input', (e) => {
            document.getElementById('sparsityValue').textContent = e.target.value + '%';
        });
        
        document.getElementById('frequency').addEventListener('input', (e) => {
            document.getElementById('frequencyValue').textContent = e.target.value + ' MHz';
        });
        
        function calculateEnergy() {
            const numLayers = parseInt(document.getElementById('numLayers').value);
            const layerWidth = parseInt(document.getElementById('layerWidth').value);
            const batchSize = parseInt(document.getElementById('batchSize').value);
            const precision = parseInt(document.getElementById('precision').value);
            const sparsity = parseFloat(document.getElementById('sparsity').value) / 100;
            const frequency = parseInt(document.getElementById('frequency').value) * 1e6;
            
            // Calculate total MACs per inference
            const totalMACs = numLayers * layerWidth * layerWidth * batchSize * (1 - sparsity);
            
            // Energy model (pJ per MAC)
            const baseEnergy = 0.1; // Base memristor switching energy
            const precisionFactor = precision / 4; // Energy scales with precision
            const energyPerMAC = baseEnergy * precisionFactor;
            
            // Total energy per inference
            const totalEnergy = totalMACs * energyPerMAC * 1e-12; // Convert to Joules
            
            // Performance calculations
            const opsPerSecond = frequency * layerWidth; // Parallel operations
            const topsRaw = opsPerSecond * 2 / 1e12; // 2 ops per MAC
            const topsEffective = topsRaw * (1 - sparsity);
            
            // Power calculation
            const power = topsEffective * 1e12 * energyPerMAC * 1e-12;
            const topsPerWatt = topsEffective / power;
            
            // Update display
            document.getElementById('energyPerMAC').textContent = energyPerMAC.toFixed(2);
            document.getElementById('topsPerWatt').textContent = topsPerWatt.toFixed(1);
            document.getElementById('totalPower').textContent = power.toFixed(1);
            document.getElementById('peakTOPS').textContent = topsEffective.toFixed(0);
            
            // Update visualizations
            createEnergyComparison(energyPerMAC);
            createScalingAnalysis(numLayers, layerWidth, precision, sparsity);
            createEnergyBreakdown(precision, sparsity);
            createEfficiencyMap();
        }
        
        function createEnergyComparison(pmnaEnergy) {
            const platforms = ['GPU (V100)', 'TPU v3', 'ASIC (EIE)', 'PMNA'];
            const energies = [10, 0.5, 0.2, pmnaEnergy]; // pJ per MAC
            const colors = ['#ef4444', '#f59e0b', '#3b82f6', '#10b981'];
            
            const trace = {
                x: platforms,
                y: energies,
                type: 'bar',
                marker: {
                    color: colors,
                    line: {
                        color: colors.map(c => c),
                        width: 2
                    }
                },
                text: energies.map(e => e.toFixed(2) + ' pJ'),
                textposition: 'outside',
                hovertemplate: '%{x}<br>Energy: %{y:.2f} pJ/MAC<extra></extra>'
            };
            
            const layout = {
                title: {
                    text: 'Energy per MAC Operation Comparison',
                    font: {color: '#f59e0b', size: 20}
                },
                xaxis: {
                    titlefont: {color: '#9ca3af'},
                    tickfont: {color: '#9ca3af'}
                },
                yaxis: {
                    title: 'Energy (pJ per MAC)',
                    type: 'log',
                    titlefont: {color: '#9ca3af'},
                    tickfont: {color: '#9ca3af'},
                    gridcolor: '#374151'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0.1)',
                height: 400
            };
            
            Plotly.newPlot('energyComparison', [trace], layout);
        }
        
        function createScalingAnalysis(layers, width, precision, sparsity) {
            // Generate scaling data
            const sizes = [128, 256, 512, 1024, 2048];
            const gpu_efficiency = sizes.map(s => 0.1 * Math.pow(s/512, -0.3));
            const pmna_efficiency = sizes.map(s => 20 * Math.pow(s/512, 0.1));
            
            const trace1 = {
                x: sizes,
                y: gpu_efficiency,
                name: 'GPU',
                type: 'scatter',
                mode: 'lines+markers',
                line: {color: '#ef4444', width: 3},
                marker: {size: 8}
            };
            
            const trace2 = {
                x: sizes,
                y: pmna_efficiency,
                name: 'PMNA',
                type: 'scatter',
                mode: 'lines+markers',
                line: {color: '#10b981', width: 3},
                marker: {size: 8}
            };
            
            const layout = {
                title: {
                    text: 'Energy Efficiency Scaling with Network Size',
                    font: {color: '#f59e0b', size: 20}
                },
                xaxis: {
                    title: 'Layer Width',
                    type: 'log',
                    titlefont: {color: '#9ca3af'},
                    tickfont: {color: '#9ca3af'},
                    gridcolor: '#374151'
                },
                yaxis: {
                    title: 'TOPS/W',
                    type: 'log',
                    titlefont: {color: '#9ca3af'},
                    tickfont: {color: '#9ca3af'},
                    gridcolor: '#374151'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0.1)',
                showlegend: true,
                legend: {
                    x: 0.02,
                    y: 0.98,
                    bgcolor: 'rgba(0,0,0,0.5)'
                },
                annotations: [{
                    x: Math.log10(width),
                    y: Math.log10(20),
                    text: 'Current Config',
                    showarrow: true,
                    arrowhead: 2,
                    ax: 40,
                    ay: -40,
                    font: {color: '#f59e0b'}
                }]
            };
            
            Plotly.newPlot('scalingAnalysis', [trace1, trace2], layout);
        }
        
        function createEnergyBreakdown(precision, sparsity) {
            // Calculate breakdown based on configuration
            const compute = 45 - sparsity * 20;
            const dacAdc = 30 + precision * 2;
            const routing = 15 + (1 - sparsity) * 5;
            const control = 100 - compute - dacAdc - routing;
            
            // Update display
            document.getElementById('computeEnergy').textContent = compute.toFixed(0) + '%';
            document.getElementById('dacAdcEnergy').textContent = dacAdc.toFixed(0) + '%';
            document.getElementById('routingEnergy').textContent = routing.toFixed(0) + '%';
            document.getElementById('controlEnergy').textContent = control.toFixed(0) + '%';
            
            const data = [{
                values: [compute, dacAdc, routing, control],
                labels: ['Computation', 'DAC/ADC', 'Routing', 'Control'],
                type: 'pie',
                hole: 0.4,
                marker: {
                    colors: ['#3b82f6', '#f59e0b', '#10b981', '#8b5cf6']
                },
                textinfo: 'label+percent',
                textposition: 'outside',
                hovertemplate: '%{label}<br>%{value:.1f}%<extra></extra>'
            }];
            
            const layout = {
                title: {
                    text: 'Energy Consumption Breakdown',
                    font: {color: '#f59e0b'}
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                showlegend: false,
                height: 400,
                font: {color: '#e5e7eb'}
            };
            
            Plotly.newPlot('energyPie', data, layout);
        }
        
        function createEfficiencyMap() {
            // Create 2D efficiency map
            const precisions = [1, 2, 3, 4, 5, 6, 7, 8];
            const sparsities = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90];
            
            const z = [];
            for (let s of sparsities) {
                const row = [];
                for (let p of precisions) {
                    // Efficiency model
                    const efficiency = 20 * (1 + s/100) / (p/4);
                    row.push(efficiency);
                }
                z.push(row);
            }
            
            const data = [{
                z: z,
                x: precisions,
                y: sparsities,
                type: 'heatmap',
                colorscale: 'Viridis',
                colorbar: {
                    title: 'TOPS/W',
                    titleside: 'right'
                },
                hovertemplate: 'Precision: %{x}-bit<br>Sparsity: %{y}%<br>Efficiency: %{z:.1f} TOPS/W<extra></extra>'
            }];
            
            const layout = {
                title: {
                    text: 'Energy Efficiency Map (TOPS/W)',
                    font: {color: '#f59e0b', size: 20}
                },
                xaxis: {
                    title: 'Precision (bits)',
                    titlefont: {color: '#9ca3af'},
                    tickfont: {color: '#9ca3af'}
                },
                yaxis: {
                    title: 'Sparsity (%)',
                    titlefont: {color: '#9ca3af'},
                    tickfont: {color: '#9ca3af'}
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0.1)'
            };
            
            Plotly.newPlot('efficiencyMap', data, layout);
        }
        
        // Initialize with default calculations
        calculateEnergy();
    </script>
</body>
</html>