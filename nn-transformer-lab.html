<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vision Transformer Lab - Neural Networks Suite</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #10b981;
            --secondary: #059669;
            --accent: #34d399;
            --dark: #0a0a0a;
            --light: #f9fafb;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #064e3b 100%);
            color: var(--light);
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .architecture-panel {
            background: rgba(16, 185, 129, 0.05);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .patch-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 4px;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .patch {
            aspect-ratio: 1;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .patch:hover {
            background: rgba(16, 185, 129, 0.3);
            transform: scale(1.1);
            z-index: 10;
        }

        .patch.active {
            background: var(--primary);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .control-group {
            background: rgba(16, 185, 129, 0.05);
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .control-label {
            color: var(--accent);
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
        }

        .control-input {
            width: 100%;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: white;
            padding: 0.5rem;
            border-radius: 0.5rem;
        }

        .slider {
            width: 100%;
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: rgba(16, 185, 129, 0.2);
            outline: none;
            margin: 0.5rem 0;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }

        .transformer-blocks {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .transformer-block {
            min-width: 150px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .transformer-block:hover {
            background: rgba(16, 185, 129, 0.2);
            transform: translateY(-5px);
        }

        .block-title {
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .block-info {
            color: #86efac;
            font-size: 0.85rem;
        }

        .visualization-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }

        .viz-panel {
            background: rgba(16, 185, 129, 0.05);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
        }

        .viz-title {
            color: var(--accent);
            font-size: 1.25rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .attention-matrix {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 2px;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0.5rem;
        }

        .attention-cell {
            aspect-ratio: 1;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .metric-card {
            background: rgba(16, 185, 129, 0.1);
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }

        .metric-label {
            color: #86efac;
            font-size: 0.85rem;
            margin-top: 0.25rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        .position-encoding {
            height: 100px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 0.5rem;
            margin-top: 1rem;
            position: relative;
            overflow: hidden;
        }

        .encoding-wave {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0.6;
        }

        @media (max-width: 1024px) {
            .visualization-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-cube"></i> Vision Transformer Lab</h1>
            <p style="color: #86efac;">Experiment with state-of-the-art Vision Transformers and hybrid architectures</p>
        </div>

        <div class="architecture-panel">
            <h2 style="color: var(--accent); margin-bottom: 1.5rem;">
                <i class="fas fa-project-diagram"></i> ViT Architecture Configuration
            </h2>

            <div class="control-panel">
                <div class="control-group">
                    <label class="control-label">Model Variant</label>
                    <select class="control-input" id="modelVariant">
                        <option value="vit-tiny">ViT-Tiny (5.7M params)</option>
                        <option value="vit-small" selected>ViT-Small (22M params)</option>
                        <option value="vit-base">ViT-Base (86M params)</option>
                        <option value="hybrid">Hybrid CNN-ViT (45M params)</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label">Patch Size</label>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <input type="range" class="slider" id="patchSize" min="8" max="32" value="16" step="8">
                        <span id="patchSizeValue" style="color: var(--accent);">16x16</span>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">Number of Layers</label>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <input type="range" class="slider" id="numLayers" min="4" max="24" value="12" step="2">
                        <span id="numLayersValue" style="color: var(--accent);">12</span>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">Attention Heads</label>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <input type="range" class="slider" id="attentionHeads" min="4" max="16" value="8" step="2">
                        <span id="attentionHeadsValue" style="color: var(--accent);">8</span>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">Hidden Dimension</label>
                    <select class="control-input" id="hiddenDim">
                        <option value="192">192</option>
                        <option value="384" selected>384</option>
                        <option value="768">768</option>
                        <option value="1024">1024</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label">MLP Ratio</label>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <input type="range" class="slider" id="mlpRatio" min="2" max="8" value="4" step="1">
                        <span id="mlpRatioValue" style="color: var(--accent);">4x</span>
                    </div>
                </div>
            </div>

            <h3 style="color: var(--accent); margin: 1.5rem 0 1rem;">
                <i class="fas fa-th"></i> Image Patches Visualization
            </h3>
            <div class="patch-grid" id="patchGrid"></div>

            <h3 style="color: var(--accent); margin: 1.5rem 0 1rem;">
                <i class="fas fa-layer-group"></i> Transformer Blocks
            </h3>
            <div class="transformer-blocks" id="transformerBlocks"></div>
        </div>

        <div class="visualization-grid">
            <div class="viz-panel">
                <h2 class="viz-title">
                    <i class="fas fa-eye"></i> Self-Attention Visualization
                </h2>
                <div class="attention-matrix" id="attentionMatrix"></div>
                <div class="position-encoding" id="positionEncoding">
                    <canvas class="encoding-wave" id="encodingCanvas"></canvas>
                </div>
            </div>

            <div class="viz-panel">
                <h2 class="viz-title">
                    <i class="fas fa-chart-line"></i> Performance Metrics
                </h2>
                <div id="performanceChart"></div>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="flops">12.6G</div>
                        <div class="metric-label">FLOPs</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="params">22M</div>
                        <div class="metric-label">Parameters</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="throughput">312</div>
                        <div class="metric-label">Images/sec</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="accuracy">96.2%</div>
                        <div class="metric-label">Top-1 Acc</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="viz-panel">
            <h2 class="viz-title">
                <i class="fas fa-brain"></i> Attention Pattern Analysis
            </h2>
            <div id="attentionHeatmap"></div>
            
            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="runInference()">
                    <i class="fas fa-play"></i> Run Inference
                </button>
                <button class="btn btn-primary" onclick="compareArchitectures()">
                    <i class="fas fa-balance-scale"></i> Compare Architectures
                </button>
                <button class="btn btn-primary" onclick="exportModel()">
                    <i class="fas fa-download"></i> Export Model
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize patch grid
        function initializePatchGrid() {
            const grid = document.getElementById('patchGrid');
            const patchSize = parseInt(document.getElementById('patchSize').value);
            const numPatches = Math.floor(224 / patchSize);
            
            grid.innerHTML = '';
            grid.style.gridTemplateColumns = `repeat(${numPatches}, 1fr)`;
            
            for (let i = 0; i < numPatches * numPatches; i++) {
                const patch = document.createElement('div');
                patch.className = 'patch';
                patch.onclick = () => selectPatch(i);
                
                // Add gradient based on position
                const row = Math.floor(i / numPatches);
                const col = i % numPatches;
                const intensity = (row + col) / (2 * numPatches);
                patch.style.background = `rgba(16, 185, 129, ${0.1 + intensity * 0.3})`;
                
                grid.appendChild(patch);
            }
        }

        // Initialize transformer blocks
        function initializeTransformerBlocks() {
            const container = document.getElementById('transformerBlocks');
            const numLayers = parseInt(document.getElementById('numLayers').value);
            
            container.innerHTML = '';
            
            // Add input embedding
            container.innerHTML += `
                <div class="transformer-block">
                    <div class="block-title">Input</div>
                    <div class="block-info">Patch Embed</div>
                </div>
            `;
            
            // Add transformer layers
            for (let i = 0; i < numLayers; i++) {
                container.innerHTML += `
                    <div class="transformer-block">
                        <div class="block-title">Layer ${i + 1}</div>
                        <div class="block-info">MHSA + MLP</div>
                    </div>
                `;
            }
            
            // Add output
            container.innerHTML += `
                <div class="transformer-block">
                    <div class="block-title">Output</div>
                    <div class="block-info">Classification</div>
                </div>
            `;
        }

        // Initialize attention matrix
        function initializeAttentionMatrix() {
            const matrix = document.getElementById('attentionMatrix');
            const heads = parseInt(document.getElementById('attentionHeads').value);
            
            matrix.innerHTML = '';
            matrix.style.gridTemplateColumns = `repeat(${heads}, 1fr)`;
            
            for (let i = 0; i < heads * heads; i++) {
                const cell = document.createElement('div');
                cell.className = 'attention-cell';
                const intensity = Math.random();
                cell.style.background = `rgba(16, 185, 129, ${intensity})`;
                if (intensity > 0.6) {
                    cell.style.boxShadow = `0 0 10px rgba(16, 185, 129, ${intensity})`;
                }
                matrix.appendChild(cell);
            }
        }

        // Initialize position encoding visualization
        function initializePositionEncoding() {
            const canvas = document.getElementById('encodingCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = 100;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw sinusoidal position encoding
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 2;
            
            for (let freq = 1; freq <= 3; freq++) {
                ctx.globalAlpha = 1 / freq;
                ctx.beginPath();
                
                for (let x = 0; x < canvas.width; x++) {
                    const y = 50 + 30 * Math.sin((x / canvas.width) * Math.PI * 2 * freq);
                    if (x === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                
                ctx.stroke();
            }
            
            ctx.globalAlpha = 1;
        }

        // Initialize performance chart
        function initializePerformanceChart() {
            const models = ['ViT-Tiny', 'ViT-Small', 'ViT-Base', 'Hybrid'];
            const accuracy = [92.3, 94.8, 96.2, 95.5];
            const speed = [520, 312, 156, 234];
            
            const trace1 = {
                x: models,
                y: accuracy,
                name: 'Accuracy (%)',
                type: 'bar',
                marker: { color: '#10b981' }
            };
            
            const trace2 = {
                x: models,
                y: speed,
                name: 'Speed (img/s)',
                type: 'bar',
                yaxis: 'y2',
                marker: { color: '#06b6d4' }
            };
            
            const layout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#86efac' },
                showlegend: true,
                legend: { x: 0.7, y: 1 },
                yaxis: {
                    title: 'Accuracy (%)',
                    gridcolor: 'rgba(16, 185, 129, 0.1)'
                },
                yaxis2: {
                    title: 'Speed (img/s)',
                    overlaying: 'y',
                    side: 'right',
                    gridcolor: 'rgba(6, 182, 212, 0.1)'
                },
                margin: { t: 20, r: 50, b: 40, l: 50 }
            };
            
            Plotly.newPlot('performanceChart', [trace1, trace2], layout, {displayModeBar: false});
        }

        // Initialize attention heatmap
        function initializeAttentionHeatmap() {
            const size = 14;
            const z = Array(size).fill().map(() => 
                Array(size).fill().map(() => Math.random())
            );
            
            // Make diagonal stronger (self-attention)
            for (let i = 0; i < size; i++) {
                z[i][i] = 0.8 + Math.random() * 0.2;
            }
            
            const data = [{
                z: z,
                type: 'heatmap',
                colorscale: [
                    [0, 'rgb(10, 10, 10)'],
                    [0.25, 'rgb(6, 78, 59)'],
                    [0.5, 'rgb(16, 185, 129)'],
                    [0.75, 'rgb(52, 211, 153)'],
                    [1, 'rgb(167, 243, 208)']
                ],
                showscale: true,
                colorbar: {
                    tickcolor: '#86efac',
                    tickfont: { color: '#86efac' }
                }
            }];
            
            const layout = {
                title: {
                    text: 'Cross-Attention Weights',
                    font: { color: '#86efac' }
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                xaxis: {
                    title: 'Query Positions',
                    gridcolor: 'rgba(16, 185, 129, 0.1)',
                    tickcolor: '#86efac'
                },
                yaxis: {
                    title: 'Key Positions',
                    gridcolor: 'rgba(16, 185, 129, 0.1)',
                    tickcolor: '#86efac'
                },
                font: { color: '#86efac' }
            };
            
            Plotly.newPlot('attentionHeatmap', data, layout, {displayModeBar: false});
        }

        // Update metrics based on configuration
        function updateMetrics() {
            const variant = document.getElementById('modelVariant').value;
            const layers = parseInt(document.getElementById('numLayers').value);
            const dim = parseInt(document.getElementById('hiddenDim').value);
            const heads = parseInt(document.getElementById('attentionHeads').value);
            
            // Calculate approximate metrics
            const params = (layers * dim * dim * 4 / 1000000).toFixed(1);
            const flops = (layers * dim * dim * 8 / 1000000000).toFixed(1);
            const throughput = Math.floor(1000 / (layers * 2));
            const accuracy = (90 + layers * 0.5 + Math.random() * 3).toFixed(1);
            
            document.getElementById('params').textContent = params + 'M';
            document.getElementById('flops').textContent = flops + 'G';
            document.getElementById('throughput').textContent = throughput;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // Event listeners
        document.getElementById('patchSize').addEventListener('input', (e) => {
            document.getElementById('patchSizeValue').textContent = e.target.value + 'x' + e.target.value;
            initializePatchGrid();
        });

        document.getElementById('numLayers').addEventListener('input', (e) => {
            document.getElementById('numLayersValue').textContent = e.target.value;
            initializeTransformerBlocks();
            updateMetrics();
        });

        document.getElementById('attentionHeads').addEventListener('input', (e) => {
            document.getElementById('attentionHeadsValue').textContent = e.target.value;
            initializeAttentionMatrix();
            updateMetrics();
        });

        document.getElementById('mlpRatio').addEventListener('input', (e) => {
            document.getElementById('mlpRatioValue').textContent = e.target.value + 'x';
            updateMetrics();
        });

        document.getElementById('modelVariant').addEventListener('change', updateMetrics);
        document.getElementById('hiddenDim').addEventListener('change', updateMetrics);

        function selectPatch(index) {
            const patches = document.querySelectorAll('.patch');
            patches.forEach((patch, i) => {
                patch.classList.toggle('active', i === index);
            });
        }

        function runInference() {
            alert('Running inference with current ViT configuration...');
            // Animation for inference
            const patches = document.querySelectorAll('.patch');
            patches.forEach((patch, i) => {
                setTimeout(() => {
                    patch.style.background = `rgba(16, 185, 129, ${Math.random()})`;
                }, i * 10);
            });
        }

        function compareArchitectures() {
            alert('Opening architecture comparison tool...');
        }

        function exportModel() {
            alert('Exporting model configuration and weights...');
        }

        // Initialize all visualizations
        initializePatchGrid();
        initializeTransformerBlocks();
        initializeAttentionMatrix();
        initializePositionEncoding();
        initializePerformanceChart();
        initializeAttentionHeatmap();
        updateMetrics();
    </script>
</body>
</html>