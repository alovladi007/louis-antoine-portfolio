<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parameter Retrieval - Metamaterials</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            font-size: 3em;
            margin-bottom: 30px;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .panel {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        h2 {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 2em;
            border-bottom: 2px solid rgba(255,215,0,0.3);
            padding-bottom: 10px;
        }
        
        h3 {
            color: #87ceeb;
            margin: 20px 0 15px 0;
            font-size: 1.4em;
        }
        
        /* Retrieval Process Flow */
        .flow-diagram {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .flow-step {
            background: rgba(0,0,0,0.5);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 20px;
            width: 200px;
            text-align: center;
            margin: 10px;
            position: relative;
        }
        
        .flow-step::after {
            content: '‚Üí';
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2em;
            color: #ffd700;
        }
        
        .flow-step:last-child::after {
            display: none;
        }
        
        .step-number {
            background: #ffd700;
            color: #000;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
        }
        
        /* Parameter Display */
        .param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .param-card {
            background: linear-gradient(135deg, rgba(0,0,0,0.6), rgba(0,0,0,0.4));
            border: 1px solid rgba(255,215,0,0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .param-title {
            color: #87ceeb;
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        
        .param-value {
            font-size: 2.5em;
            color: #ffd700;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .param-complex {
            font-size: 1.8em;
            color: #ffd700;
            margin: 10px 0;
        }
        
        .param-real {
            color: #00ff00;
        }
        
        .param-imag {
            color: #ff6b6b;
        }
        
        /* Equations */
        .equation-box {
            background: rgba(0,0,0,0.7);
            border-left: 4px solid #ffd700;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            overflow-x: auto;
        }
        
        .equation-title {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            overflow-x: auto;
            display: block;
        }
        
        .data-table table {
            width: 100%;
            min-width: 800px;
        }
        
        .data-table th {
            background: rgba(255,215,0,0.2);
            padding: 15px;
            text-align: left;
            border: 1px solid rgba(255,255,255,0.3);
            font-weight: 600;
            white-space: nowrap;
        }
        
        .data-table td {
            padding: 12px 15px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(0,0,0,0.3);
            white-space: nowrap;
        }
        
        .data-table tr:hover td {
            background: rgba(255,255,255,0.05);
        }
        
        /* Plots */
        .plot-container {
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            min-height: 350px;
            position: relative;
        }
        
        .plot-title {
            text-align: center;
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .plot-area {
            background: linear-gradient(to bottom, 
                transparent 0%, 
                rgba(255,255,255,0.02) 25%,
                rgba(255,255,255,0.02) 25%,
                transparent 50%,
                transparent 50%,
                rgba(255,255,255,0.02) 75%,
                rgba(255,255,255,0.02) 75%,
                transparent 100%
            );
            background-size: 100% 80px;
            height: 250px;
            border-left: 2px solid rgba(255,255,255,0.3);
            border-bottom: 2px solid rgba(255,255,255,0.3);
            margin: 20px 40px 40px 60px;
            position: relative;
        }
        
        .plot-line {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            overflow: hidden;
        }
        
        .n-real-line {
            background: linear-gradient(to right,
                transparent 0%,
                rgba(0,255,0,0.3) 10%,
                rgba(0,255,0,0.3) 30%,
                rgba(255,0,0,0.3) 30%,
                rgba(255,0,0,0.3) 60%,
                rgba(0,255,0,0.3) 60%,
                rgba(0,255,0,0.3) 90%,
                transparent 100%
            );
            border-top: 3px solid #00ff00;
            height: 60%;
            margin-top: 20%;
        }
        
        .n-imag-line {
            background: linear-gradient(to right,
                transparent 0%,
                rgba(255,100,100,0.3) 10%,
                rgba(255,100,100,0.3) 90%,
                transparent 100%
            );
            border-top: 3px solid #ff6b6b;
            height: 30%;
            margin-top: 50%;
        }
        
        /* Info boxes */
        .info-box {
            background: rgba(135,206,235,0.1);
            border: 1px solid rgba(135,206,235,0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .warning-box {
            background: rgba(255,99,71,0.1);
            border: 1px solid rgba(255,99,71,0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .success-box {
            background: rgba(0,255,0,0.1);
            border: 1px solid rgba(0,255,0,0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 30px;
            height: 3px;
        }
        
        .highlight {
            background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,255,255,0.1));
            border: 2px solid gold;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ Parameter Retrieval from S-Parameters</h1>
        
        <div class="highlight">
            <h2 style="border: none; margin-bottom: 10px;">Extracting Material Properties from Measurements</h2>
            <p>Advanced retrieval algorithms to determine Œµ, Œº, n, and Z from S-parameter data</p>
        </div>
        
        <!-- Retrieval Process Flow -->
        <div class="panel">
            <h2>Retrieval Process Overview</h2>
            
            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="step-number">1</div>
                    <strong>S-Parameters</strong>
                    <p>S‚ÇÅ‚ÇÅ, S‚ÇÇ‚ÇÅ measured</p>
                </div>
                <div class="flow-step">
                    <div class="step-number">2</div>
                    <strong>Impedance</strong>
                    <p>Z from S‚ÇÅ‚ÇÅ, S‚ÇÇ‚ÇÅ</p>
                </div>
                <div class="flow-step">
                    <div class="step-number">3</div>
                    <strong>Index</strong>
                    <p>n from phase</p>
                </div>
                <div class="flow-step">
                    <div class="step-number">4</div>
                    <strong>Œµ and Œº</strong>
                    <p>Œµ = n/Z, Œº = nZ</p>
                </div>
                <div class="flow-step">
                    <div class="step-number">5</div>
                    <strong>Validation</strong>
                    <p>Check consistency</p>
                </div>
            </div>
        </div>
        
        <!-- NRW Method -->
        <div class="panel">
            <h2>Nicolson-Ross-Weir (NRW) Method</h2>
            
            <div class="equation-box">
                <div class="equation-title">Step 1: Calculate Intermediate Variables</div>
                V‚ÇÅ = S‚ÇÇ‚ÇÅ + S‚ÇÅ‚ÇÅ<br>
                V‚ÇÇ = S‚ÇÇ‚ÇÅ - S‚ÇÅ‚ÇÅ<br><br>
                
                <div class="equation-title">Step 2: Reflection Coefficient</div>
                X = (1 - V‚ÇÅV‚ÇÇ)/(V‚ÇÅ - V‚ÇÇ)<br>
                Œì = X ¬± ‚àö(X¬≤ - 1)<br>
                Choose: |Œì| < 1 for passive medium<br><br>
                
                <div class="equation-title">Step 3: Transmission Coefficient</div>
                T = (V‚ÇÅ - Œì)/(1 - V‚ÇÅŒì)<br><br>
                
                <div class="equation-title">Step 4: Impedance and Refractive Index</div>
                Z = ‚àö[(1 + S‚ÇÅ‚ÇÅ)¬≤ - S‚ÇÇ‚ÇÅ¬≤]/[(1 - S‚ÇÅ‚ÇÅ)¬≤ - S‚ÇÇ‚ÇÅ¬≤]<br>
                n = -(1/k‚ÇÄd) ln(T)<br><br>
                
                <div class="equation-title">Step 5: Permittivity and Permeability</div>
                Œµ = n/Z<br>
                Œº = nZ
            </div>
        </div>
        
        <!-- Retrieved Parameters Display -->
        <div class="panel">
            <h2>Retrieved Effective Parameters at 1.5 THz</h2>
            
            <div class="param-grid">
                <div class="param-card">
                    <div class="param-title">Refractive Index (n)</div>
                    <div class="param-complex">
                        <span class="param-real">-1.52</span> + 
                        <span class="param-imag">0.08i</span>
                    </div>
                </div>
                <div class="param-card">
                    <div class="param-title">Impedance (Z)</div>
                    <div class="param-complex">
                        <span class="param-real">0.65</span> + 
                        <span class="param-imag">0.02i</span>
                    </div>
                </div>
                <div class="param-card">
                    <div class="param-title">Permittivity (Œµ)</div>
                    <div class="param-complex">
                        <span class="param-real">-2.34</span> + 
                        <span class="param-imag">0.15i</span>
                    </div>
                </div>
                <div class="param-card">
                    <div class="param-title">Permeability (Œº)</div>
                    <div class="param-complex">
                        <span class="param-real">-0.99</span> + 
                        <span class="param-imag">0.06i</span>
                    </div>
                </div>
                <div class="param-card">
                    <div class="param-title">Figure of Merit</div>
                    <div class="param-value">19.0</div>
                    <div style="color: #87ceeb; font-size: 0.9em;">|Re(n)|/Im(n)</div>
                </div>
                <div class="param-card">
                    <div class="param-title">Loss Tangent</div>
                    <div class="param-value">0.064</div>
                    <div style="color: #87ceeb; font-size: 0.9em;">Im(Œµ)/Re(Œµ)</div>
                </div>
            </div>
        </div>
        
        <!-- Frequency Dependent Results -->
        <div class="panel">
            <h2>Frequency-Dependent Retrieved Parameters</h2>
            
            <!-- Refractive Index Plot -->
            <div class="plot-container">
                <div class="plot-title">Refractive Index vs Frequency</div>
                <div class="plot-area">
                    <div class="plot-line n-real-line"></div>
                    <div class="plot-line n-imag-line"></div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #00ff00;"></div>
                        <span>Re(n)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff6b6b;"></div>
                        <span>Im(n)</span>
                    </div>
                </div>
            </div>
            
            <!-- Data Table -->
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Freq (THz)</th>
                            <th>Re(n)</th>
                            <th>Im(n)</th>
                            <th>Re(Œµ)</th>
                            <th>Im(Œµ)</th>
                            <th>Re(Œº)</th>
                            <th>Im(Œº)</th>
                            <th>FOM</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>0.5</td>
                            <td>1.45</td>
                            <td>0.05</td>
                            <td>2.10</td>
                            <td>0.08</td>
                            <td>1.00</td>
                            <td>0.03</td>
                            <td>29.0</td>
                        </tr>
                        <tr>
                            <td>0.8</td>
                            <td>0.82</td>
                            <td>0.06</td>
                            <td>0.67</td>
                            <td>0.10</td>
                            <td>1.00</td>
                            <td>0.04</td>
                            <td>13.7</td>
                        </tr>
                        <tr>
                            <td>1.0</td>
                            <td>-0.35</td>
                            <td>0.07</td>
                            <td>-0.85</td>
                            <td>0.12</td>
                            <td>-0.41</td>
                            <td>0.05</td>
                            <td>5.0</td>
                        </tr>
                        <tr>
                            <td>1.2</td>
                            <td>-1.12</td>
                            <td>0.08</td>
                            <td>-1.75</td>
                            <td>0.14</td>
                            <td>-0.72</td>
                            <td>0.06</td>
                            <td>14.0</td>
                        </tr>
                        <tr>
                            <td>1.5</td>
                            <td>-1.52</td>
                            <td>0.08</td>
                            <td>-2.34</td>
                            <td>0.15</td>
                            <td>-0.99</td>
                            <td>0.06</td>
                            <td>19.0</td>
                        </tr>
                        <tr>
                            <td>1.8</td>
                            <td>-0.95</td>
                            <td>0.09</td>
                            <td>-1.45</td>
                            <td>0.16</td>
                            <td>-0.62</td>
                            <td>0.07</td>
                            <td>10.6</td>
                        </tr>
                        <tr>
                            <td>2.0</td>
                            <td>0.68</td>
                            <td>0.10</td>
                            <td>0.46</td>
                            <td>0.18</td>
                            <td>1.00</td>
                            <td>0.08</td>
                            <td>6.8</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Branch Selection -->
        <div class="panel">
            <h2>Branch Selection and Phase Unwrapping</h2>
            
            <div class="warning-box">
                <h3>‚ö†Ô∏è Critical Considerations</h3>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><strong>Branch ambiguity:</strong> Multiple solutions exist for n due to logarithm</li>
                    <li><strong>Phase unwrapping:</strong> Required when kd > œÄ</li>
                    <li><strong>Thickness resonances:</strong> Occur when d = mŒª/2</li>
                    <li><strong>Causality check:</strong> Kramers-Kronig relations must be satisfied</li>
                </ul>
            </div>
            
            <div class="equation-box">
                <div class="equation-title">Phase Unwrapping Algorithm:</div>
                n_unwrapped = n_principal + m<br>
                where m = round[(n_{i-1} - n_principal)]<br><br>
                
                <div class="equation-title">Kramers-Kronig Consistency:</div>
                Re[Œµ(œâ)] - 1 = (2/œÄ) P ‚à´‚ÇÄ^‚àû [œâ'¬∑Im[Œµ(œâ')]/(œâ'¬≤-œâ¬≤)] dœâ'<br>
                Im[Œµ(œâ)] = -(2œâ/œÄ) P ‚à´‚ÇÄ^‚àû [Re[Œµ(œâ')-1]/(œâ'¬≤-œâ¬≤)] dœâ'
            </div>
        </div>
        
        <!-- Validation Methods -->
        <div class="panel">
            <h2>Validation and Error Analysis</h2>
            
            <div class="info-box">
                <h3>Validation Checks Performed:</h3>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li>‚úÖ Passivity: Im(Œµ) > 0, Im(Œº) > 0</li>
                    <li>‚úÖ Causality: Kramers-Kronig relations satisfied</li>
                    <li>‚úÖ Reciprocity: S‚ÇÅ‚ÇÇ = S‚ÇÇ‚ÇÅ for passive medium</li>
                    <li>‚úÖ Energy conservation: |S‚ÇÅ‚ÇÅ|¬≤ + |S‚ÇÇ‚ÇÅ|¬≤ ‚â§ 1</li>
                    <li>‚úÖ Stability: Retrieved parameters smooth vs frequency</li>
                </ul>
            </div>
            
            <div class="param-grid">
                <div class="param-card">
                    <div class="param-title">RMS Error</div>
                    <div class="param-value">2.3%</div>
                    <div style="color: #87ceeb; font-size: 0.9em;">S-parameter fit</div>
                </div>
                <div class="param-card">
                    <div class="param-title">Phase Error</div>
                    <div class="param-value">¬±3¬∞</div>
                    <div style="color: #87ceeb; font-size: 0.9em;">Maximum deviation</div>
                </div>
                <div class="param-card">
                    <div class="param-title">Thickness Uncertainty</div>
                    <div class="param-value">¬±2 Œºm</div>
                    <div style="color: #87ceeb; font-size: 0.9em;">Impact on n: ¬±0.01</div>
                </div>
            </div>
        </div>
        
        <!-- Alternative Methods -->
        <div class="panel">
            <h2>Alternative Retrieval Methods</h2>
            
            <table class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>Advantages</th>
                            <th>Disadvantages</th>
                            <th>Best Use Case</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>NRW</strong></td>
                            <td>Direct, analytical</td>
                            <td>Branch ambiguity</td>
                            <td>Thin samples (d < Œª)</td>
                        </tr>
                        <tr>
                            <td><strong>NIST Iterative</strong></td>
                            <td>Robust, stable</td>
                            <td>Computationally intensive</td>
                            <td>Thick samples</td>
                        </tr>
                        <tr>
                            <td><strong>Differential</strong></td>
                            <td>No branch issues</td>
                            <td>Requires two samples</td>
                            <td>Low-loss materials</td>
                        </tr>
                        <tr>
                            <td><strong>Optimization</strong></td>
                            <td>Flexible constraints</td>
                            <td>Local minima</td>
                            <td>Complex structures</td>
                        </tr>
                    </tbody>
                </table>
            </table>
        </div>
        
        <div class="success-box">
            <h3>‚úÖ Successful Parameter Extraction</h3>
            <p>The retrieved parameters confirm negative index behavior (n < 0) in the 1.0-1.8 THz band with both Œµ < 0 and Œº < 0, 
            validating the metamaterial design. The high FOM (>5) indicates low losses suitable for practical applications.</p>
        </div>
        
        <div class="highlight">
            <h3 style="color: #ffd700;">Summary</h3>
            <p>Parameter retrieval successfully extracted n = -1.52 + 0.08i at 1.5 THz with FOM = 19, confirming double-negative metamaterial behavior</p>
        </div>
    </div>
</body>
</html>