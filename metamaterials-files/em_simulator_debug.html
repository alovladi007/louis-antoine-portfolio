<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EM Simulator - Debug Version</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { background: #0a0a0a; color: #e5e7eb; font-family: Arial; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { color: #f59e0b; text-align: center; }
        .debug { background: #222; border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { color: #0f0; }
        .error { color: #f00; }
        .control-panel { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; margin: 20px 0; }
        button { background: #9333ea; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 5px; cursor: pointer; }
        button:hover { background: #7c3aed; }
        .tab { display: inline-block; padding: 10px 20px; background: #333; margin: 2px; cursor: pointer; border-radius: 5px; }
        .tab.active { background: #8e24aa; }
        input[type="range"] { width: 200px; }
        .value { background: #8e24aa; padding: 2px 8px; border-radius: 10px; display: inline-block; }
    </style>
</head>
<body>
    <div class="container">
        <h1>EM Field Simulator - Debug Version</h1>
        
        <div class="debug">
            <h3>Debug Console:</h3>
            <div id="debug-log"></div>
        </div>
        
        <div class="control-panel">
            <h2>Test Controls</h2>
            
            <div>
                <h3>1. Basic JavaScript Test:</h3>
                <button onclick="testBasicJS()">Test Basic JS</button>
                <button onclick="testAlert()">Test Alert</button>
                <button onclick="testConsole()">Test Console</button>
            </div>
            
            <div style="margin-top: 20px;">
                <h3>2. DOM Manipulation Test:</h3>
                <button onclick="testDOM()">Change Background</button>
                <button onclick="testCreate()">Create Element</button>
                <div id="test-div" style="padding: 10px; background: #333; margin: 10px 0;">Test Div</div>
            </div>
            
            <div style="margin-top: 20px;">
                <h3>3. Solver Tabs Test:</h3>
                <div id="solver-tabs">
                    <span class="tab active" data-solver="fdtd">FDTD</span>
                    <span class="tab" data-solver="fem">FEM</span>
                    <span class="tab" data-solver="rcwa">RCWA</span>
                    <span class="tab" data-solver="tmm">TMM</span>
                </div>
                <div id="solver-status">Current: FDTD</div>
            </div>
            
            <div style="margin-top: 20px;">
                <h3>4. Input Controls Test:</h3>
                <label>Test Slider: </label>
                <input type="range" id="test-slider" min="0" max="100" value="50">
                <span class="value" id="slider-value">50</span>
                <br>
                <select id="test-select">
                    <option>Option 1</option>
                    <option>Option 2</option>
                    <option>Option 3</option>
                </select>
                <span id="select-value">Option 1</span>
            </div>
            
            <div style="margin-top: 20px;">
                <h3>5. Plotly Test:</h3>
                <button onclick="testPlotly()">Create Plotly Chart</button>
                <div id="plotly-test" style="height: 300px; background: #111; margin: 10px 0;"></div>
            </div>
            
            <div style="margin-top: 20px;">
                <h3>6. Animation Test:</h3>
                <button onclick="startAnimation()">Start Animation</button>
                <button onclick="stopAnimation()">Stop Animation</button>
                <canvas id="canvas-test" width="400" height="200" style="background: #111; display: block; margin: 10px 0;"></canvas>
            </div>
        </div>
    </div>
    
    <script>
        // Debug logging function
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const entry = document.createElement('div');
            entry.className = type === 'error' ? 'error' : 'success';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            console.log(message);
        }
        
        // Page load test
        window.addEventListener('DOMContentLoaded', function() {
            log('✓ DOMContentLoaded event fired');
            log('✓ JavaScript is working');
            log('✓ Plotly loaded: ' + (typeof Plotly !== 'undefined'));
            setupEventListeners();
        });
        
        // Basic JS tests
        function testBasicJS() {
            log('✓ Button click works');
            const result = 2 + 2;
            log('✓ Math works: 2 + 2 = ' + result);
        }
        
        function testAlert() {
            alert('Alert works!');
            log('✓ Alert displayed');
        }
        
        function testConsole() {
            console.log('Console test message');
            log('✓ Check browser console for message');
        }
        
        // DOM tests
        function testDOM() {
            document.body.style.background = '#' + Math.floor(Math.random()*16777215).toString(16);
            log('✓ Background color changed');
        }
        
        function testCreate() {
            const div = document.createElement('div');
            div.textContent = 'New element created at ' + new Date().toLocaleTimeString();
            div.style.padding = '10px';
            div.style.background = '#444';
            div.style.margin = '5px 0';
            document.getElementById('test-div').appendChild(div);
            log('✓ New element created');
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Solver tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    const solver = this.dataset.solver;
                    document.getElementById('solver-status').textContent = 'Current: ' + solver.toUpperCase();
                    log('✓ Switched to ' + solver.toUpperCase());
                });
            });
            
            // Slider
            const slider = document.getElementById('test-slider');
            slider.addEventListener('input', function() {
                document.getElementById('slider-value').textContent = this.value;
                log('✓ Slider value: ' + this.value);
            });
            
            // Select
            const select = document.getElementById('test-select');
            select.addEventListener('change', function() {
                document.getElementById('select-value').textContent = this.value;
                log('✓ Selected: ' + this.value);
            });
            
            log('✓ Event listeners attached');
        }
        
        // Plotly test
        function testPlotly() {
            try {
                const data = [{
                    x: [1, 2, 3, 4, 5],
                    y: [2, 4, 3, 5, 6],
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: {color: '#9333ea'}
                }];
                
                const layout = {
                    title: 'Test Plot',
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0.1)',
                    font: {color: '#fff'}
                };
                
                Plotly.newPlot('plotly-test', data, layout);
                log('✓ Plotly chart created');
            } catch (e) {
                log('✗ Plotly error: ' + e.message, 'error');
            }
        }
        
        // Animation test
        let animating = false;
        let animFrame = 0;
        
        function startAnimation() {
            if (animating) return;
            animating = true;
            log('✓ Animation started');
            animate();
        }
        
        function stopAnimation() {
            animating = false;
            log('✓ Animation stopped');
        }
        
        function animate() {
            if (!animating) return;
            
            const canvas = document.getElementById('canvas-test');
            const ctx = canvas.getContext('2d');
            
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#9333ea';
            const x = 200 + Math.sin(animFrame * 0.05) * 100;
            const y = 100 + Math.cos(animFrame * 0.03) * 50;
            ctx.beginPath();
            ctx.arc(x, y, 20, 0, Math.PI * 2);
            ctx.fill();
            
            animFrame++;
            requestAnimationFrame(animate);
        }
        
        // Error handling
        window.addEventListener('error', function(e) {
            log('✗ JavaScript Error: ' + e.message + ' at line ' + e.lineno, 'error');
        });
    </script>
</body>
</html>