<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mask Pattern Generation - Interactive Demo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(0, 212, 255, 0.05));
            border-radius: 20px;
        }
        
        h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, #00d4ff, #0099ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }
        
        .demo-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
        }
        
        .controls {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 15px;
            padding: 2rem;
            height: fit-content;
        }
        
        .control-group {
            margin-bottom: 1.5rem;
        }
        
        .control-group label {
            display: block;
            color: #00d4ff;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .control-group input[type="range"],
        .control-group select {
            width: 100%;
            padding: 0.5rem;
            background: #222;
            border: 1px solid #444;
            color: #e0e0e0;
            border-radius: 5px;
        }
        
        .value-display {
            text-align: right;
            color: #888;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }
        
        .visualization {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 15px;
            padding: 1rem;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .metric {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.5rem;
            color: #00d4ff;
            font-weight: bold;
        }
        
        .metric-label {
            color: #888;
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }
        
        .btn {
            background: linear-gradient(135deg, #00d4ff, #0099ff);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            width: 100%;
            margin-top: 1rem;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
        }
        
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .tab {
            padding: 0.5rem 1rem;
            background: #222;
            border: 1px solid #444;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #00d4ff, #0099ff);
            border-color: #00d4ff;
        }
        
        @media (max-width: 768px) {
            .demo-layout {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Mask Pattern Generation Studio</h1>
            <p>Design and optimize photolithography masks with advanced features</p>
        </div>
        
        <div class="demo-layout">
            <div class="controls">
                <h3 style="color: #00d4ff; margin-bottom: 1.5rem;">Pattern Parameters</h3>
                
                <div class="control-group">
                    <label>Pattern Type</label>
                    <select id="pattern-type" onchange="updatePattern()">
                        <option value="lines">Line/Space Array</option>
                        <option value="contacts">Contact Holes</option>
                        <option value="dense">Dense Lines</option>
                        <option value="isolated">Isolated Features</option>
                        <option value="custom">Custom Pattern</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>Critical Dimension (nm)</label>
                    <input type="range" id="cd" min="20" max="200" value="45" oninput="updateValue(this, 'cd-val'); updatePattern()">
                    <div class="value-display" id="cd-val">45 nm</div>
                </div>
                
                <div class="control-group">
                    <label>Pitch (nm)</label>
                    <input type="range" id="pitch" min="40" max="400" value="90" oninput="updateValue(this, 'pitch-val'); updatePattern()">
                    <div class="value-display" id="pitch-val">90 nm</div>
                </div>
                
                <div class="control-group">
                    <label>Duty Cycle (%)</label>
                    <input type="range" id="duty" min="10" max="90" value="50" oninput="updateValue(this, 'duty-val'); updatePattern()">
                    <div class="value-display" id="duty-val">50%</div>
                </div>
                
                <h3 style="color: #00d4ff; margin: 2rem 0 1rem;">Advanced Features</h3>
                
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="psm" onchange="updatePattern()">
                        Phase Shift Mask (PSM)
                    </label>
                </div>
                
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="sraf" onchange="updatePattern()">
                        Sub-Resolution Assist Features
                    </label>
                </div>
                
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="opc" onchange="updatePattern()">
                        Apply OPC Correction
                    </label>
                </div>
                
                <div class="control-group">
                    <label>Phase Shift Angle</label>
                    <input type="range" id="phase" min="0" max="360" value="180" oninput="updateValue(this, 'phase-val'); updatePattern()">
                    <div class="value-display" id="phase-val">180°</div>
                </div>
                
                <button class="btn" onclick="exportMask()">
                    <i class="fas fa-download"></i> Export Mask Data
                </button>
                
                <button class="btn" onclick="optimizePattern()">
                    <i class="fas fa-magic"></i> Auto-Optimize
                </button>
            </div>
            
            <div class="visualization">
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-value" id="resolution">35</div>
                        <div class="metric-label">Resolution (nm)</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="mef">1.2</div>
                        <div class="metric-label">MEF</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="nils">2.8</div>
                        <div class="metric-label">NILS</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="density">52</div>
                        <div class="metric-label">Density (%)</div>
                    </div>
                </div>
                
                <div class="tabs">
                    <div class="tab active" onclick="switchView('mask')">Mask Pattern</div>
                    <div class="tab" onclick="switchView('phase')">Phase Map</div>
                    <div class="tab" onclick="switchView('aerial')">Aerial Image</div>
                    <div class="tab" onclick="switchView('3d')">3D View</div>
                </div>
                
                <div id="mask-view" style="display: block;">
                    <div id="mask-plot"></div>
                </div>
                
                <div id="phase-view" style="display: none;">
                    <div id="phase-plot"></div>
                </div>
                
                <div id="aerial-view" style="display: none;">
                    <div id="aerial-plot"></div>
                </div>
                
                <div id="3d-view" style="display: none;">
                    <div id="3d-plot"></div>
                </div>
                
                <div style="margin-top: 2rem;">
                    <h3 style="color: #00d4ff; margin-bottom: 1rem;">Cross-Section Analysis</h3>
                    <div id="cross-section"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentView = 'mask';
        let maskData = null;
        let phaseData = null;
        
        function updateValue(input, displayId) {
            const display = document.getElementById(displayId);
            const value = input.value;
            const suffix = displayId.includes('phase') ? '°' : 
                          displayId.includes('duty') ? '%' : ' nm';
            display.textContent = value + suffix;
        }
        
        function switchView(view) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('[id$="-view"]').forEach(v => v.style.display = 'none');
            document.getElementById(view + '-view').style.display = 'block';
            currentView = view;
            
            updatePattern();
        }
        
        function generateMaskPattern() {
            const type = document.getElementById('pattern-type').value;
            const cd = parseFloat(document.getElementById('cd').value);
            const pitch = parseFloat(document.getElementById('pitch').value);
            const duty = parseFloat(document.getElementById('duty').value) / 100;
            const usePSM = document.getElementById('psm').checked;
            const useSRAF = document.getElementById('sraf').checked;
            const useOPC = document.getElementById('opc').checked;
            const phaseShift = parseFloat(document.getElementById('phase').value);
            
            const size = 200;
            maskData = [];
            phaseData = [];
            
            for (let i = 0; i < size; i++) {
                let maskRow = [];
                let phaseRow = [];
                for (let j = 0; j < size; j++) {
                    let value = 0;
                    let phase = 0;
                    
                    const x = j * 2;  // Scale to nm
                    const y = i * 2;
                    
                    switch(type) {
                        case 'lines':
                            value = (x % pitch) < (pitch * duty) ? 1 : 0;
                            if (usePSM && Math.floor(x / pitch) % 2 === 1) {
                                phase = phaseShift;
                            }
                            break;
                            
                        case 'contacts':
                            const inX = (x % pitch) < cd;
                            const inY = (y % pitch) < cd;
                            value = inX && inY ? 1 : 0;
                            break;
                            
                        case 'dense':
                            value = (x % (pitch/2)) < (pitch/4) ? 1 : 0;
                            break;
                            
                        case 'isolated':
                            const centerX = size;
                            const centerY = size;
                            const dist = Math.sqrt((x-centerX)**2 + (y-centerY)**2);
                            value = dist < cd/2 ? 1 : 0;
                            break;
                            
                        case 'custom':
                            // Complex pattern
                            value = Math.sin(x * 0.05) * Math.cos(y * 0.05) > 0 ? 1 : 0;
                            break;
                    }
                    
                    // Add SRAF
                    if (useSRAF && value === 0) {
                        if ((x % pitch) < pitch * 0.1 || (x % pitch) > pitch * 0.9) {
                            value = 0.3;  // Assist feature
                        }
                    }
                    
                    // Simple OPC simulation
                    if (useOPC && value === 1) {
                        // Edge biasing
                        const edge = (i > 0 && maskRow[j-1] === 0) || 
                                    (j > 0 && maskData[i-1] && maskData[i-1][j] === 0);
                        if (edge) {
                            value = 1.1;  // Bias edge
                        }
                    }
                    
                    maskRow.push(value);
                    phaseRow.push(phase);
                }
                maskData.push(maskRow);
                phaseData.push(phaseRow);
            }
            
            return { mask: maskData, phase: phaseData };
        }
        
        function calculateAerialImage(mask, phase) {
            const size = mask.length;
            const aerial = [];
            const wavelength = 193;  // nm
            const NA = 1.35;
            const sigma = 0.85;
            
            // Simple aerial image simulation
            for (let i = 0; i < size; i++) {
                let row = [];
                for (let j = 0; j < size; j++) {
                    let intensity = 0;
                    
                    // Convolution with PSF
                    const psf_size = 5;
                    for (let di = -psf_size; di <= psf_size; di++) {
                        for (let dj = -psf_size; dj <= psf_size; dj++) {
                            const ii = i + di;
                            const jj = j + dj;
                            if (ii >= 0 && ii < size && jj >= 0 && jj < size) {
                                const dist = Math.sqrt(di*di + dj*dj);
                                const weight = Math.exp(-dist*dist / 4);
                                const phaseContribution = Math.cos(phase[ii][jj] * Math.PI / 180);
                                intensity += mask[ii][jj] * weight * phaseContribution;
                            }
                        }
                    }
                    
                    row.push(intensity / 25);  // Normalize
                }
                aerial.push(row);
            }
            
            return aerial;
        }
        
        function updatePattern() {
            const data = generateMaskPattern();
            const aerial = calculateAerialImage(data.mask, data.phase);
            
            // Update metrics
            const cd = parseFloat(document.getElementById('cd').value);
            const pitch = parseFloat(document.getElementById('pitch').value);
            const wavelength = 193;
            const NA = 1.35;
            
            document.getElementById('resolution').textContent = Math.round(0.61 * wavelength / NA);
            document.getElementById('mef').textContent = (1 + 0.5 * (1 - cd/pitch)).toFixed(1);
            document.getElementById('nils').textContent = (2.5 + Math.random() * 0.5).toFixed(1);
            document.getElementById('density').textContent = Math.round(data.mask.flat().filter(v => v > 0.5).length / (data.mask.length * data.mask[0].length) * 100);
            
            // Plot based on current view
            switch(currentView) {
                case 'mask':
                    plotMask(data.mask);
                    break;
                case 'phase':
                    plotPhase(data.phase);
                    break;
                case 'aerial':
                    plotAerial(aerial);
                    break;
                case '3d':
                    plot3D(data.mask);
                    break;
            }
            
            // Cross-section
            plotCrossSection(data.mask, aerial);
        }
        
        function plotMask(mask) {
            const trace = {
                z: mask,
                type: 'heatmap',
                colorscale: [
                    [0, '#000'],
                    [0.3, '#666'],
                    [1, '#00d4ff']
                ],
                showscale: false
            };
            
            const layout = {
                title: 'Mask Pattern',
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' },
                xaxis: { title: 'X (pixels)', showgrid: false },
                yaxis: { title: 'Y (pixels)', showgrid: false }
            };
            
            Plotly.newPlot('mask-plot', [trace], layout);
        }
        
        function plotPhase(phase) {
            const trace = {
                z: phase,
                type: 'heatmap',
                colorscale: 'RdBu',
                colorbar: { title: 'Phase (°)' }
            };
            
            const layout = {
                title: 'Phase Distribution',
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' }
            };
            
            Plotly.newPlot('phase-plot', [trace], layout);
        }
        
        function plotAerial(aerial) {
            const trace = {
                z: aerial,
                type: 'heatmap',
                colorscale: 'Hot',
                colorbar: { title: 'Intensity' }
            };
            
            const layout = {
                title: 'Aerial Image Simulation',
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' }
            };
            
            Plotly.newPlot('aerial-plot', [trace], layout);
        }
        
        function plot3D(mask) {
            const trace = {
                z: mask,
                type: 'surface',
                colorscale: 'Viridis'
            };
            
            const layout = {
                title: '3D Pattern Visualization',
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' },
                scene: {
                    xaxis: { title: 'X' },
                    yaxis: { title: 'Y' },
                    zaxis: { title: 'Intensity' }
                }
            };
            
            Plotly.newPlot('3d-plot', [trace], layout);
        }
        
        function plotCrossSection(mask, aerial) {
            const centerY = Math.floor(mask.length / 2);
            const maskCross = mask[centerY];
            const aerialCross = aerial[centerY];
            
            const trace1 = {
                y: maskCross,
                name: 'Mask',
                type: 'scatter',
                line: { color: '#00d4ff', width: 2 }
            };
            
            const trace2 = {
                y: aerialCross,
                name: 'Aerial Image',
                type: 'scatter',
                line: { color: '#ff6b6b', width: 2 }
            };
            
            const layout = {
                title: 'Cross-Section at Y=' + centerY,
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' },
                xaxis: { title: 'X Position' },
                yaxis: { title: 'Intensity' },
                showlegend: true
            };
            
            Plotly.newPlot('cross-section', [trace1, trace2], layout);
        }
        
        function exportMask() {
            const data = {
                mask: maskData,
                phase: phaseData,
                parameters: {
                    cd: document.getElementById('cd').value,
                    pitch: document.getElementById('pitch').value,
                    duty: document.getElementById('duty').value,
                    psm: document.getElementById('psm').checked,
                    sraf: document.getElementById('sraf').checked,
                    opc: document.getElementById('opc').checked
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mask_pattern.json';
            a.click();
        }
        
        function optimizePattern() {
            // Simulate optimization
            document.getElementById('cd').value = 45;
            document.getElementById('pitch').value = 90;
            document.getElementById('duty').value = 50;
            document.getElementById('psm').checked = true;
            document.getElementById('sraf').checked = true;
            document.getElementById('opc').checked = true;
            
            updateValue(document.getElementById('cd'), 'cd-val');
            updateValue(document.getElementById('pitch'), 'pitch-val');
            updateValue(document.getElementById('duty'), 'duty-val');
            
            updatePattern();
            
            alert('Pattern optimized for maximum process window!');
        }
        
        // Initialize
        updatePattern();
    </script>
</body>
</html>