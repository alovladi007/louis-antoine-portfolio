<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zernike Polynomials - Wavefront Aberration Analysis</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #0a1a2a 100%);
            color: #e0e0e0;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }
        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: rgba(6, 182, 212, 0.05);
            border-radius: 20px;
            border: 1px solid rgba(6, 182, 212, 0.2);
        }
        h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }
        .main-layout {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
        }
        .control-panel {
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            height: fit-content;
        }
        .panel-title {
            color: #06b6d4;
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }
        .aberration-controls {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        .aberration-group {
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: #222;
            border-radius: 8px;
        }
        .aberration-name {
            color: #06b6d4;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        .aberration-slider {
            width: 100%;
        }
        .btn {
            width: 100%;
            padding: 0.75rem;
            margin-top: 0.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
            font-weight: 500;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(6, 182, 212, 0.3);
        }
        .viz-panel {
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
        }
        .viz-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .metric {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 8px;
            padding: 0.75rem;
            text-align: center;
        }
        .metric-value {
            font-size: 1.2rem;
            color: #06b6d4;
            font-weight: bold;
        }
        .metric-label {
            color: #888;
            font-size: 0.7rem;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Zernike Polynomials</h1>
            <p>Wavefront Aberration Analysis & Optical System Characterization</p>
        </div>
        
        <div class="main-layout">
            <div class="control-panel">
                <h3 class="panel-title">
                    <i class="fas fa-circle"></i> Aberration Coefficients
                </h3>
                
                <div class="aberration-controls">
                    <div class="aberration-group">
                        <div class="aberration-name">Z4: Defocus</div>
                        <input type="range" class="aberration-slider" id="z4" min="-1" max="1" step="0.1" value="0">
                        <div style="text-align: right; color: #888; font-size: 0.8rem;">0.0 λ</div>
                    </div>
                    
                    <div class="aberration-group">
                        <div class="aberration-name">Z5: Astigmatism 0°</div>
                        <input type="range" class="aberration-slider" id="z5" min="-1" max="1" step="0.1" value="0">
                        <div style="text-align: right; color: #888; font-size: 0.8rem;">0.0 λ</div>
                    </div>
                    
                    <div class="aberration-group">
                        <div class="aberration-name">Z6: Astigmatism 45°</div>
                        <input type="range" class="aberration-slider" id="z6" min="-1" max="1" step="0.1" value="0">
                        <div style="text-align: right; color: #888; font-size: 0.8rem;">0.0 λ</div>
                    </div>
                    
                    <div class="aberration-group">
                        <div class="aberration-name">Z7: Coma X</div>
                        <input type="range" class="aberration-slider" id="z7" min="-1" max="1" step="0.1" value="0">
                        <div style="text-align: right; color: #888; font-size: 0.8rem;">0.0 λ</div>
                    </div>
                    
                    <div class="aberration-group">
                        <div class="aberration-name">Z8: Coma Y</div>
                        <input type="range" class="aberration-slider" id="z8" min="-1" max="1" step="0.1" value="0">
                        <div style="text-align: right; color: #888; font-size: 0.8rem;">0.0 λ</div>
                    </div>
                    
                    <div class="aberration-group">
                        <div class="aberration-name">Z9: Spherical</div>
                        <input type="range" class="aberration-slider" id="z9" min="-1" max="1" step="0.1" value="0">
                        <div style="text-align: right; color: #888; font-size: 0.8rem;">0.0 λ</div>
                    </div>
                </div>
                
                <button class="btn" onclick="calculateWavefront()">
                    <i class="fas fa-calculator"></i> Calculate Wavefront
                </button>
                
                <button class="btn" onclick="resetAberrations()">
                    <i class="fas fa-redo"></i> Reset All
                </button>
                
                <button class="btn" onclick="loadPreset()">
                    <i class="fas fa-bookmark"></i> Load Preset
                </button>
            </div>
            
            <div class="viz-area">
                <div class="metrics">
                    <div class="metric">
                        <div class="metric-value" id="rms">0.00</div>
                        <div class="metric-label">RMS (λ)</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="pv">0.00</div>
                        <div class="metric-label">P-V (λ)</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="strehl">1.00</div>
                        <div class="metric-label">Strehl Ratio</div>
                    </div>
                </div>
                
                <div class="viz-grid">
                    <div class="viz-panel">
                        <h3 class="panel-title">3D Wavefront</h3>
                        <div id="wavefront-3d"></div>
                    </div>
                    <div class="viz-panel">
                        <h3 class="panel-title">2D Wavefront Map</h3>
                        <div id="wavefront-2d"></div>
                    </div>
                    <div class="viz-panel">
                        <h3 class="panel-title">PSF</h3>
                        <div id="psf"></div>
                    </div>
                    <div class="viz-panel">
                        <h3 class="panel-title">MTF</h3>
                        <div id="mtf"></div>
                    </div>
                </div>
                
                <div class="viz-panel">
                    <h3 class="panel-title">Zernike Coefficient Spectrum</h3>
                    <div id="coefficient-spectrum"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Update slider values
        document.querySelectorAll('.aberration-slider').forEach(slider => {
            slider.addEventListener('input', function() {
                this.nextElementSibling.textContent = this.value + ' λ';
            });
        });
        
        function calculateWavefront() {
            alert('Calculating Zernike Wavefront...');
            generateWavefront();
            updateMetrics();
        }
        
        function resetAberrations() {
            document.querySelectorAll('.aberration-slider').forEach(slider => {
                slider.value = 0;
                slider.nextElementSibling.textContent = '0.0 λ';
            });
            calculateWavefront();
        }
        
        function loadPreset() {
            // Load a preset aberration pattern
            document.getElementById('z4').value = 0.3;
            document.getElementById('z5').value = -0.2;
            document.getElementById('z9').value = 0.15;
            
            document.querySelectorAll('.aberration-slider').forEach(slider => {
                slider.nextElementSibling.textContent = slider.value + ' λ';
            });
            
            calculateWavefront();
        }
        
        function generateWavefront() {
            const size = 50;
            const wavefront = [];
            
            // Get Zernike coefficients
            const z4 = parseFloat(document.getElementById('z4').value);
            const z5 = parseFloat(document.getElementById('z5').value);
            const z6 = parseFloat(document.getElementById('z6').value);
            const z7 = parseFloat(document.getElementById('z7').value);
            const z8 = parseFloat(document.getElementById('z8').value);
            const z9 = parseFloat(document.getElementById('z9').value);
            
            for (let i = 0; i < size; i++) {
                const row = [];
                for (let j = 0; j < size; j++) {
                    const x = (i - size/2) / (size/2);
                    const y = (j - size/2) / (size/2);
                    const r = Math.sqrt(x*x + y*y);
                    
                    if (r <= 1) {
                        // Calculate Zernike polynomial values
                        let w = 0;
                        w += z4 * (2*r*r - 1); // Defocus
                        w += z5 * r*r * Math.cos(2*Math.atan2(y, x)); // Astigmatism
                        w += z6 * r*r * Math.sin(2*Math.atan2(y, x));
                        w += z7 * r * Math.cos(Math.atan2(y, x)); // Coma
                        w += z8 * r * Math.sin(Math.atan2(y, x));
                        w += z9 * (6*Math.pow(r, 4) - 6*r*r + 1); // Spherical
                        row.push(w);
                    } else {
                        row.push(null);
                    }
                }
                wavefront.push(row);
            }
            
            // 3D Wavefront
            Plotly.newPlot('wavefront-3d', [{
                z: wavefront,
                type: 'surface',
                colorscale: 'Viridis',
                showscale: false
            }], {
                title: '3D Wavefront',
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' },
                scene: {
                    xaxis: { title: 'X' },
                    yaxis: { title: 'Y' },
                    zaxis: { title: 'Phase (λ)' }
                }
            });
            
            // 2D Wavefront
            Plotly.newPlot('wavefront-2d', [{
                z: wavefront,
                type: 'heatmap',
                colorscale: 'RdBu',
                zmid: 0
            }], {
                title: '2D Map',
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' }
            });
            
            // PSF
            const psf = wavefront.map(row => 
                row.map(v => v !== null ? Math.exp(-Math.abs(v)*10) : 0)
            );
            
            Plotly.newPlot('psf', [{
                z: psf,
                type: 'heatmap',
                colorscale: 'Hot',
                showscale: false
            }], {
                title: 'Point Spread Function',
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' }
            });
            
            // MTF
            const freq = [];
            const mtf = [];
            for (let f = 0; f <= 100; f += 5) {
                freq.push(f);
                const aberrationEffect = Math.sqrt(z4*z4 + z5*z5 + z6*z6 + z7*z7 + z8*z8 + z9*z9);
                mtf.push(Math.exp(-f/30 - aberrationEffect*f/50));
            }
            
            Plotly.newPlot('mtf', [{
                x: freq,
                y: mtf,
                type: 'scatter',
                mode: 'lines',
                line: { color: '#06b6d4', width: 2 }
            }], {
                title: 'MTF',
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' },
                xaxis: { title: 'Frequency (lp/mm)' },
                yaxis: { title: 'MTF' }
            });
            
            // Coefficient spectrum
            const coeffs = [z4, z5, z6, z7, z8, z9];
            const names = ['Z4', 'Z5', 'Z6', 'Z7', 'Z8', 'Z9'];
            
            Plotly.newPlot('coefficient-spectrum', [{
                x: names,
                y: coeffs,
                type: 'bar',
                marker: { color: '#06b6d4' }
            }], {
                title: 'Zernike Coefficients',
                paper_bgcolor: '#111',
                plot_bgcolor: '#111',
                font: { color: '#e0e0e0' },
                yaxis: { title: 'Coefficient (λ)' }
            });
        }
        
        function updateMetrics() {
            // Calculate RMS
            const coeffs = [];
            document.querySelectorAll('.aberration-slider').forEach(slider => {
                coeffs.push(parseFloat(slider.value));
            });
            
            const rms = Math.sqrt(coeffs.reduce((sum, c) => sum + c*c, 0) / coeffs.length);
            document.getElementById('rms').textContent = rms.toFixed(3);
            
            // Calculate P-V
            const pv = Math.max(...coeffs.map(Math.abs)) * 2;
            document.getElementById('pv').textContent = pv.toFixed(2);
            
            // Calculate Strehl ratio
            const strehl = Math.exp(-Math.pow(2 * Math.PI * rms, 2));
            document.getElementById('strehl').textContent = strehl.toFixed(3);
        }
        
        window.onload = function() {
            calculateWavefront();
        };
    </script>
</body>
</html>